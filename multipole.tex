\documentclass[11pt,a4paper]{memoir}
\def\asydir{\jobname}
\usepackage{thesis-preamble}
\pstoolsetup{mode=errorstop}
\EndPreamble
\begin{document}

\chapter{Multipole arrays for improved levitation}
\chaplabel{multipole}

\epigraph{Another common characteristic of most magnet experts is an unwillingness or inability to communicate their knowledge to others.}{\textcite{moskowitz1995}}

\referpaper{The material presented in \secref{optim-halbach-1d} is based on work that has been published as a journal paper~\cite{robertson2010-maglett}.}

\section{Introduction}

The magnetic designs presented in \chapref{magnet-theory} are based around various configurations of multiple discrete magnets each oriented in specific directions.
In this chapter, a preliminary analysis is presented on using `multipole' magnet arrays, which are groups of magnets stacked together with varying directions of magnetisation within the array.

Early work in this area focussed on using multipole stacks for magnetic bearings (see \figref[vref]{backers-bearing}), which continue to see research focus in areas such as artificial hearts \parencite{chen2002,finocchiaro2008,samiappan2008}, and wind power generation \parencite{liu2008-ietm}.
The theory for these magnetic bearings assumed originally that the effect of curvature of the ring magnets to be negligible and analysed the forces between two large flat plates with non-uniform magnetisation as if multiple magnets were stacked together to form a planar structure.
In such early cases, it was shown that a North--South alternating magnetisation (\ie, \ang{180} rotations between successive magnets) across the plates yields stronger forces than homogeneous magnetisation \cite{backers1961}.
Using \ang{90} rotation increments the stiffness can be approximately doubled again while keeping the magnet volume constant \cite{yonnet1991}; further optimisation of such systems can yield improvements of up to an order of magnitude \cite{moser2006}.
Early work by the author of this thesis demonstrated how these ideas could be used when applied to magnetic springs as discussed in \chapref{magnet-design} \cite{robertson2005-ietm}.

\begin{figure}
\includegraphics{PhD/Figures/Multipole/halbach.pdf}
\caption
  [Magnetic flux lines of a Halbach array.]
  {
    Magnetic field lines for a multipole array with \ang{45} magnetisation rotations (indicated by the arrowheads).
    The single-sided nature of the magnet field is evident.
  }
\figlabel{halbach}
\end{figure}

It was not until the wide-spread availability of the high energy density rare-earth magnets in the late 1970s that more complicated multipole magnetic geometries became feasible.
The classic multipole array is a linear array of magnets stacked to approximate a single magnet with sinusoidal magnetisation, first analysed in the 1970s \parencite{halbach1981,shute2000-ietm}.
  \note{Multipole magnet arrays are often refered to as `Halbach arrays' in a system approximating sinusoidal magnetisation such as shown in \figref{halbach}. The more generic `multipole' is used in this thesis to cover both Halbach arrays and planar arrays with \twoD/ magnetisation variation.}
The main feature of these multipole arrays is to focus the magnetic field, which can increase the magnetic flux density on one side of the array and to reduce or eliminate any need for magnetic shielding on the reverse side.
The lines of magnetic flux produced by one such multipole array is shown in \figref{halbach}, in which the single-sided nature of the magnetic field can clearly be seen.
This figure shows magnets with \ang{45} increments of magnetisation, but any integer division of \ang{360} is possible.

To emphasise the approximately single-sided nature of these arrays, consider the three multipole arrays shown in \figref{halbach-lion} with contours of magnetic field strength.
The multipole arrays are arranged all in repulsion, but the top pair have their strong sides facing whereas the bottom pair have their weak sides facing.
In this static arrangement, the forces between the strong pair are about 200 times stronger than the weak pair.
As well as increasing the stength of the magnetic field in the desired area of use, this has the added advantage of `shielding' external equipment from the field where the magnetic forces are not required, although there are other various possiblities to effect magnetic shielding \cite{becherini2009}.
Such inherent shielding makes these arrays particularly beneficial in \maglev/ transportation \cite{hoburg2004}, where strong, stray magnetic fields are potentially dangerous to external equipment or personnel.

\begin{figure}
   \centering
   \grf[height=0.4\textheight]{Figures/Multipole/halbach-lion-fieldstr}
   \lofcaption{Opposing Halbach arrays demonstrating magnetic field strength on the strong and weak sides.}{ Magnitude of magnetic field is shown varying from blue (weak) to red (strong).}
   \figlabel{halbach-lion}
\end{figure}

An examination of the flux lines of various facing Halbach arrays shows how flux interacts between the two separate linear arrays (\figref{halbach-flux-repl,halbach-flux-attr}).
It can be seen that by varying the direction of magnetisation of the first magnet in the second array, a full range of forces can be achieved between the arrays â€” at the limits, total
attraction or repulsion in the vertical direction, as shown in \figref{halbach-flux-repl,halbach-flux-attr} \resp.
The variation of vertical force with horizontal displacement must be carefully considered in the design of a levitation system using such multipole arrays.

\begin{figure}
\begin{wide}
  \begin{subfigure}
  \includegraphics{PhD/Figures/Multipole/2-halb-repl}
  \caption{In repulsion.\figlabel{halbach-flux-repl}}
  \end{subfigure}\hfil
\begin{subfigure}
  \includegraphics{PhD/Figures/Multipole/2-halb-attr}
  \caption{In attraction.\figlabel{halbach-flux-attr}}
\end{subfigure}
\end{wide}
\caption{Magnetic field lines of linear multipole arrays.}
\end{figure}

Multipole arrays have been analysed for a variety of force-producing applications; one particular area that has received significant attention that will not be considered here is for generating magnetic fields for use in rotary, linear, and planar actuations systems \parencite{marinescu1992,trumper1993-ieia-conf,cho2001,zhu2001-ipep,lee2004-mx,jang2005a,jang2005b,kimoulakis2008,lee2006-mx,min2010-ietm}.
There are a range of designs also presented for cylindrical and spherical actuator/bearing design \cite{zhu2001-ipep,yan2006-iemx,xia2008-ietm}, which is outside of the work considered in this thesis.
Some of these devices use unique multipole arrangements, and in some cases these may be of interest for magnetic levitation as larger magnetic fields will produce larger magnetic forces.

Since multipole arrays usually attempt to emulate a sinusoidal magnetisation with discrete, homogeneous magnets, several authors have studied the use of triangular or trapezoidal magnets to attempt to better emulate such magnetisation \cite{cho2001,lee2006-mx,choi2008,meessen2008-ietm,marble2008-ietm}.
The theory for calculating the magnetic fields and forces between such irregular magnet shapes is beginning to appear in the literature \cite{janssen2009-ietm}, but little work has been done to date on optimising such multipole arrays for levitation purposes.

It bears noting that the construction of these arrays can be quite difficult since the magnets are oriented in various forms of repulsion except in the case of \SI{180}{\degree} alternation.
Few studies have examined the effect of these repulsive forces on the construction of the former required to hold the magnets in place \cite{rovers2009-ietm}.

In the following sections, the magnetic theory presented in \chapref{magnet-theory} is abstracted for use to analyse linear and planar multipole arrays constructed of cuboid-shaped magnets.
It is shown how such systems may be optimised by considering the design parameters for such arrays.


\section{Geometry of multipole magnet arrays}
\seclabel{multipole-geom}

Having expressed the forces between two magnets with arbitrary magnetisation (\secref*{magforce-arbitary}), it becomes simple to use this expression iteratively over an array of magnets with varying magnetisation strengths or directions. The force between two arrays is simply the superposition of every combination of forces between the individual magnets in each array.
While several authors have published work using the superposition method as presented here \cite{allag2009-electromotion,janssen2009-jsdd}, this is the most detailed formalisation of the approach.

Some abstractions to the manner in which the iteration over each combination of magnets is performed allows us to simplify the code necessary to express a variety of configurations of the multiple arrays.
This facilitates logical comparisons between different designs.

A multipole array can be uniquely defined in terms of several sets of variables.
The simplest such description is:
\begin{itemize}
\item Size of each magnet $[\mupmaglength,\mupdepth,\mupheight]\T$,
\item Number of magnets $\mupNmag$,
\item Magnetisation direction of the first magnet $\mupmagpol$ and rotation between successive magnets $\mupmagrot$, and
\item Additional gap between adjacent magnet faces $\mupfacegap$ (optional).
\end{itemize}
Other variables that can also be used to describe the array are:
\begin{itemize}
\item Length of the array $\muplength = \mupmaglength \mupNmag$,
\item Number of magnets per wavelength $\mupmagperwave=2\pi/\mupmagpol$,
\item Wavelength of magnetisation $\mupwavelength= \mupmaglength \mupmagperwave$, and
\item Number of wavelengths $\mupNwaves=[\mupNmag-1]/\mupmagperwave$.
\end{itemize}
\figref{multipole-variables} illustrates the relationship between magnet length, array length, and wavelength for an example linear array. The wavelength of magnetisation is the length required to achieve, with successive magnets, a full rotation of magnetisation direction.
As the number of magnets per wavelength of magnetisation $\mupmagperwave$ increases, the magnetisation pattern of the array more closely approximates true sinusoidal magnetisation, as shown in \figref{wavelength}.

\begin{figure}
\centering
\pregen{\asyinclude{PhD/Figures/Multipole/multipole-variables}}
\caption
[Geometry of a linear Halbach array with four magnets per wavelength of magnetisation.]
{Geometry of a linear Halbach array with four magnets ($\mupmagperwave=4$) of length $\mupmaglength$ per wavelength of magnetisation $\mupwavelength$. This array contains two wavelengths of magnetisation ($\mupNwaves=2$) with an end magnet for symmetry.}
\figlabel{multipole-variables}
\end{figure}

\begin{figure}
\centering
\pregen{\asyinclude{PhD/Figures/Multipole/magperwave}}
\caption
[Three Halbach arrays of equal length.]
{Three Halbach arrays of equal length, facing up, each with a single wavelength of magnetisation and composed of $\mupmagperwave\in\{2,4,8\}$ magnets per wavelength respectively.}
\figlabel{wavelength}
\end{figure}

Note the presence in \figref{halbach,multipole-variables} and in general of an `end magnet' that adds symmetry to the discretisation of the magnetisation. This extra magnet is necessary to balance the forces in the horizontal direction.

Provided that enough information is specified and it is internally consistent, multipole arrays can be defined in terms of any combination of the magnet and array variables when defining the geometry of each array.
Rather than explicitly enumerating the location and magnetic orientation of each magnet, software written to calculate multipole array forces (\secref*{repro-research}) requires just an axis with which to align the array and the facing direction of its `strong' side.
Input variables can be specified only as necessary by the user, and the unspecified properties of the multitude of magnets in the arrays can be inferred directly.

For the design of such software, however, it is not entirely straightforward to determine how a variety of specified input variables should be processed to define the unspecified ones, since the equations of constraint are not orthogonal.
Using a collection of conditional statements becomes cumbersome, since many permutations of possible input variables must be accounted for.
Furthermore, additions of variables to the code becomes difficult since each path through the code must be analysed and possibly edited to correspond to the overall changes.
For this reason, a mathematical approach to processing input variables and calculating the unspecified ones is presented.

Since the variables considered previously are not all orthogonal, it is useful to express the coupled ones (only) as equations of constraint which need to be solved simultaneously:
\begin{align}\eqlabel{mup-cons}
\mupwavelength &= \mupmagperwave \muplength, &
\muplength &= \mupNmag \mupmaglength, &
\mupNwaves &= \mupNmag/\mupmagperwave, &
\mupmagperwave &= 360\text{\textdegree}/\mupmagrot,
\end{align}
where, for convenience, the additional end magnet (for symmetry) is omitted.
Taking logarithms and writing these constraints \eqref{mup-cons} in matrix form yields
\begin{equation}
\eqlabel{mup-cons-matrix}
\begin{bmatrix}
1 & 0 & 0 & -1 &  0 & -1 & 0 \\
0 & 1 & 0 & -1 & -1 &  0 & 0 \\
0 & 0 & 1 &  0 & -1 &  1 & 0 \\
0 & 0 & 0 &  0 &  0 &  1 & 1 \\
\end{bmatrix}
\log\mathopen{}
\begin{bmatrix}
\mupwavelength\\
\muplength\\
\mupNwaves\\
\mupmaglength\\
\mupNmag\\
\mupmagperwave\\
\mupmagrot
\end{bmatrix}
\mathclose{}
=
\begin{bmatrix}
0\\0\\0\\\log(360\text{\textdegree})
\end{bmatrix}
\end{equation}
This matrix can be used to compute the variables needed given sufficient inputs to define the problem.
For example, say a magnet array was defined in terms of magnetisation wavelength, total length, magnets per wavelength, and number of wavelengths.
In this case, the left hand side of \eqref{mup-cons-matrix} is separated into two matrices of specified variables
\begin{equation}
\eqlabel{mup-cons-known}
\begin{bmatrix}
1 & 0 & 0 & -1 \\
0 & 1 & 0 &  0 \\
0 & 0 & 1 &  1 \\
0 & 0 & 0 &  1 \\
\end{bmatrix}
\log\mathopen{}
\begin{bmatrix}
\mupwavelength\\
\muplength\\
\mupNwaves\\
\mupmagperwave\\
\end{bmatrix}
\mathclose{}
= V,
\end{equation}
and unspecified variables
\begin{equation}
\eqlabel{mup-cons-known}
\begin{bmatrix}
-1 &  0 & 0 \\
-1 & -1 & 0 \\
 0 & -1 & 0 \\
 0 &  0 & 1 \\
\end{bmatrix}
\log\mathopen{}
\begin{bmatrix}
\mupmaglength\\
\mupNmag\\
\mupmagrot
\end{bmatrix}
\mathclose{}
= V^*,
\end{equation}
where
\begin{equation}
\eqlabel{mup-cons-solve}
V+V^*=
\begin{bmatrix}
0\\0\\0\\\log(360\text{\textdegree})
\end{bmatrix}.
\end{equation}
The unspecified variables can then be calculated by solving for $V$ in \eqref{mup-cons-known} and for $V^*$ in \eqref{mup-cons-solve}.
This process is generalisable provided that the specified variables are defined sufficiently.
Furthermore, in the case that more variables are specified than required, the unspecified variables will still be calculated correctly provided that the specified variables are consistent with \eqref{mup-cons}.
If the specified variables are not consistent, the solution process will fail, providing a simple method to check the validity of the input.

Using this process yields properties of the multipole arrays as defined in \eqref{mup-cons}.
As previously mentioned, it is undesirable to have an integer number of wavelengths of magnetisation in the magnet arrays such that $\mupNmag=\mupNwaves\mupmagperwave$ as the horizontal force between two arrays is non-zero when aligned vertically.
It is preferable to achieve zero lateral force by incorporating an additional end magnet such that $\mupNmag=\mupNwaves\mupmagperwave+1$.
However, this equation cannot be represented in the aforementioned linear (after taking logarithms) algebra of \eqref{mup-cons-known}.
Therefore, these corrections are made in a separate step after the solution process has been undertaken.


%%%%%%%%%%%%%%%%%

\section{Towards optimising the forces between linear multipole arrays}
\seclabel{optim-halbach-1d}

Having covered the theory for representing the geometry of linear multipole arrays in \secref{multipole-geom}, this section investigates the optimisation of force characteristics between linear multipole magnet arrays as a function of array size and magnet arrangement using cuboid-shaped magnets.

A linear `Halbach array' composed of magnets with $\mupNmag$ magnets aligned along an horizontal axis is considered; planar and volumetric stacks that have multiple magnets in the other directions will be considered in \secref{planar-multipole}.

The magnetic flux pattern of the array is dependent also on the wavelength of magnetisation $\mupwavelength$. As the wavelength of magnetisation decreases, the total number of magnets used in the array increases, for a fixed array length $\muplength$. The relationship between wavelength, array length, and number of magnets has been shown in \figref{multipole-variables}.
The volume of magnetic material will be fixed, and the number of magnets will be inferred from the other specified variables.
There are therefore only two independent variables to consider when choosing the parameters for a linear Halbach array of a certain size: number of magnets per wavelength $\mupmagperwave$, and total number of wavelengths~$\mupNwaves$ in the array.
Note the one extra magnet will always be included to balance the forces in the horizontal direction (shown in \figref{wavelength,multipole-variables}) such that the total number of wavelengths \mbox{$\mupNwaves=[\muplength-\mupmaglength]/\mupwavelength$}.


\subsection{Varying magnetisation discretisation and wavelength}
\seclabel{Nwaves}

Consider two linear Halbach arrays of equal size with height $\mupheight=\SI{10}{mm}$, square cross section, and length $\muplength=\SI{100}{mm}$. Their strong sides are aligned towards each other and their magnetisation pattern is such that there is a repulsive force between them.
The vertical displacement between their centres is $\mupvdispl$, which can be normalised by the height of the arrays; $\mupvdispl/\mupheight=1$ corresponds to the position at which the faces of the two arrays are touching.
The forces between the arrays are calculated using superposition of the forces between each permutation of magnet pairs in the two arrays \parencite{allag2009-electromotion}. 
Results are shown in \figref{Nwaves} of the force \vs\ normalised vertical displacement  for number of magnets per wavelength $\mupmagperwave\in\{2,4,8\}$ and number of wavelengths $\mupNwaves\in\{1,2,4\}$; these multipole forces are compared to the forces generated between a pair of magnets of homogeneous magnetisation which have the same dimensions as the multipole arrays.

For a small number of wavelengths, the discretisation of the magnetisation makes little difference to the force characteristic (\figref{Nwaves1}).
But as the number of wavelengths increases the number of magnets per wavelength has an increasing effect.
Increasing the number of magnets per wavelength $\mupmagperwave$ increases the forces over all values of displacement considered (\figref{Nwaves4}).

\begin{figure*}
\begin{wide}
\centerline{%
\hspace*{-1cm}
\subfloat[$\mupNwaves=1$\figlabel{Nwaves1}]{\psfragfig{magcode/examples/magspring/fig/halbach-waves-Nwaves-1}}
\subfloat[$\mupNwaves=2$\figlabel{Nwaves2}]{\psfragfig{magcode/examples/magspring/fig/halbach-waves-Nwaves-2}}
\subfloat[$\mupNwaves=4$\figlabel{Nwaves4}]{\psfragfig{magcode/examples/magspring/fig/halbach-waves-Nwaves-4}}%
}
\end{wide}
\caption
[Vertical force \vs\ displacement between two facing linear Halbach arrays with a varying number of magnets per wavelength and wavelengths of magnetisation.]
{Vertical force \vs\ vertical displacement normalised by the array height $\mupheight$ between two facing linear Halbach arrays with a varying number of magnets per wavelength~$\mupmagperwave$ and a varying number of wavelengths of magnetisation~$\mupNwaves$. The dashed line is the force between two single magnets of equal size to the arrays.}
\figlabel{Nwaves}
\end{figure*}

Therefore, as a general design guideline, it is only necessary to use a large number of magnets per wavelength if there is at least several wavelengths of magnetisation in total in the array. In the results shown in \figref{Nwaves}, the ratio in forces between $\mupmagperwave=2$ and $\mupmagperwave=4$ is greater than the ratio in forces between $\mupmagperwave=4$ and $\mupmagperwave=8$; most of the benefit of increasing the number of magnets is realised using four magnets per wavelength of magnetisation (i.e., 90\textdegree\ rotations between successive magnets such as shown in \figref{multipole-variables}). In cases where there are many more wavelengths of magnetisation again (as shown in \figref{Nmag-max} later), there is a greater advantage to using $\mupmagperwave=8$ over $\mupmagperwave=4$. Therefore, the greater number of wavelengths of magnetisation, the greater the force improvement realised by increasing the number of magnets per wavelength.

The use of multipole arrays can have a significant effect on the useful range of the force/displacement characteristic.
As the number of wavelengths increases, the magnetic field of each array becomes stronger but the magnetic field lines exhibit smaller excursions outside the magnet array before returning. Thus, the forces become stronger but over a smaller displacement, and therefore the stiffness of the magnetic spring is increased as well. For some purposes and in some cases, this can be detrimental in that it can increase the resonance frequency of the system, resulting in poorer vibration isolation properties.

\subsection{Constant number of magnets}
\seclabel{Nmag-const}

The results shown previously have in general indicated that improvements to the force characteristic are seen with a greater number of magnets. However, given a minimum magnet thickness that can be fabricated, and hence for a given array length a maximum total number of magnets, it is not clear how the compromise should be made between maximising the number of wavelengths $\mupNwaves$ and the number of magnets per wavelength $\mupmagperwave$.
An illustration of the extremes in this case is shown in \figref{mup-max-nmag}, in which two multipole arrays composed of the same number and size of magnets are displayed.
The first has the minimum number of wavelengths of magnetisation ($\mupNwaves=1$), and the second has minimum number of magnets per wavelength ($\mupmagperwave=2$).

\begin{figure}
\centering
\pregen{\asyinclude{\jobname/multipole-max-nmag}}
\caption{Two multipole arrays of equal length and number of magnets demonstrating extremes in wavelength of magnetisation $\mupNwaves$ and number of magnets per wavelength $\mupmagperwave$.}
\figlabel{mup-max-nmag}
\end{figure}

In order to investigate this compromise, consider an array of the same outer dimensions as the previous example (height $\mupheight=\SI{10}{mm}$, square cross section, and length $\muplength=\SI{100}{mm}$) composed of magnets each of length $\mupmaglength=\SI{2}{mm}$ and of cross-sectional area \SI{10x10}{mm}, such that there are \num{50} magnets in the array. The force characteristic for two of these arrays in repulsion, again with $\mupmagperwave\in\{2,4,8\}$, is shown in \figref{Nmag-max}. In this extreme example with a large number of wavelengths of magnetisation~$\mupNwaves$, the strong region of the field is close to the surfaces of the arrays and there is considerable difference in the curves for each number of magnets per wavelength~$\mupmagperwave$; maximising $\mupmagperwave$ produces stronger results providing there are sufficiently many wavelengths of magnetisation along the length of the array. When $\mupNwaves$ is small (say $\mupNwaves<5$) for a fixed magnet size, these general results do not hold and the design possibilities must be evaluated on a case-by-case basis.

\begin{figure}
\centering
\psfragfig{magcode/examples/magspring/fig/halbach-max-Nmag}
\caption
[Force characteristic with arrays each composed of fifty magnets.]
{Force characteristic with arrays each composed of fifty magnets of length $\mupmaglength=\SI{2}{mm}$, over a variety of number of magnets per wavelength~$\mupmagperwave$. The dashed line is the force between two homogeneous magnets of length \SI{100}{mm}.}
\figlabel{Nmag-max}
\end{figure}

\subsection{Non-equal magnet sizes}
\seclabel{quasi-ratio}

While the force characteristic of an eight-magnet wavelength ($\mupmagperwave=8$) array can outperform the four-magnet ($\mupmagperwave=4$) array, the latter can be improved in some cases by adjusting the relative sizes of the magnets in the array.
Consider the four-magnet array shown in \figref{mupmagratio-schem} in which the horizontally-polarised magnets of length $\mupqlh$ are smaller than the vertically-polarised magnets of length $\mupqlv$.
Magnet size ratio $\mupqratio=\mupqlh/\mupqlv$ is the measure used here to compare different array configurations, for which $\mupqratio=0$ corresponds to an array composed only of vertically-oriented magnets, and $\mupqratio=1$ corresponds to equally-sized magnets of both horizontal and vertical magnetisations (as considered previously in this section).

\begin{figure}
\centering
\pregen{\asyinclude{PhD/Figures/Multipole/magratio}}
\lofcaption{Schematic of a four-magnet Halbach array with variable magnet sizes.}{ The number of magnets per wavelength $\mupmagperwave=4$ for all arrays of this type except in the degenerate case of $\mupqlh=0$, hence $\mupmagperwave=2$.}
\figlabel{mupmagratio-schem}
\end{figure}

\Figref{ratios-compare} compares the force characteristic with a variety of magnet size ratios for arrays composed of nine magnets (\ie, two wavelengths of magnetisation with a symmetry magnet), of length $\muplength=\SI{100}{mm}$, and of cross-sectional area \SI{10x10}{mm}.
As expected from the previous results, $\mupqratio=0$ results in smaller forces than for $\mupqratio=1$; however, $\mupqratio=0.5$ results in slightly greater forces again: an increase of 5\% at a displacement of approximately $\mupvdispl=1.3\mupheight$, tapering off as the displacement increases.
(This value of $\mupqratio$ is close to optimum for this system; see \figref{ratios-forcesum}.)
This result can be justified intuitively with the recognition that there is a stronger vertical force between opposing vertically-polarised magnets than between horizontally-polarised magnets; dedicating a greater proportion of the magnet volume to the vertical magnets yields an increase in the total force.

\begin{figure}
\begin{wide}
\begin{subfigure}
\psfragfig{magcode/examples/magspring/fig/ratios-compare}
\caption{Force--displacement characteristic between arrays with $\mupNwaves=2$.}
\figlabel{ratios-compare}
\end{subfigure}\hfil
\begin{subfigure}
\psfragfig{magcode/examples/magspring/fig/ratios-forcesum}
\caption{Integral of the force--displacement characteristic \vs\ magnet length ratio $\mupqratio$ of two modified Halbach arrays over a displacement range of \SIrange{10}{20}{mm}.}
\figlabel{ratios-forcesum}
\end{subfigure}
\end{wide}
\caption
  [Influence of the magnet length ratio on the force between two modified Halbach arrays.]
  {
    Influence of the magnet length ratio $\mupqratio$ on the force characteristics of two modified Halbach arrays in opposition; each has size \SI{100x10x10}{mm}.
  }
\end{figure}

However, as the number of wavelengths of magnetisation~$\mupNwaves$ increases, there is a decrease in the improvement offered by reducing the size of the horizontal magnets.
This can be quantified by comparing the integral of force over the displacement range of interest for a variety of magnet length ratios~$\mupqratio$.
In \figref{ratios-forcesum}, such results are shown (for the same arrays discussed previously) comparing the relative difference of the force--displacement integral as a function of the magnet length ratio, normalised by the integral results for $\mupqratio=1$.
Since the force improvement with adjusting $\mupqratio$ is only significant for low numbers of wavelength of magnetisation, this technique is only suitable for increasing the forces when a small total number of magnets are to be used, perhaps for ease of construction of the magnet array. Otherwise, it is more efficient simply to increase the number of magnets than to change the magnet size ratio.

\subsubsection{Separation between successive magnets}

In the preceding analysis, all calculations have been performed assuming that there is zero separation between successive magnets in the multipole arrays.
If the arrays are constructed from standard magnets, there will usually be a thin coating on the magnets to prevent corrosion.
By allowing some additional separation between the magnets, it may simplify the construction of the arrays to use a non-magnetic former, in which solid walls are used to locate and hold each magnet in place.
The magnets in this case will have a small separation between their faces in the direction in which they are stacked; it is important to evaluate the influence this separation has on the generated forces.

A simulation was performed using opposing multipole arrays constructed of nine \SI{1}{T} $\gp{\SI{10}{mm}}^3$ cube magnets (\figref{mup-sep}).
The magnets were polarised for two wavelengths of magnetisation; additionally, a separation $\mupfacegap$ was added between each successive magnet.
The force--displacement characteristic was calculated for the arrays while varying the separation distance $\mupfacegap$ (\figref{halbach-gaps}).
The results are presented in terms of normalised vertical displacement $\mupvdispl/\mupheight$ and normalised separation distance $\mupfacegap/\mupmaglength$.

Even comparatively thin wall thicknesses compared to the magnet size have a noticeable effect on the forces generated at small vertical displacements $\mupvdispl$ between the arrays.
The far-field forces are less affected, implying for large multipole array structures it is indeed suitable to add a magnet separation using a nonmagnetic former to set the magnets in place.
As shown in the figure, however, once the separation distance becomes large enough, it is better to simply use opposing magnets; the magnet separation is so large that the magnetic interaction between the magnets is limited to the directly opposing pairs.
Since the magnetic force between opposing parallel magnets is less than anti-parallel opposing magnets (recall \secref*{cube-compare-orth}), this arrangement results in smaller forces than having a set of widely spaced magnets all magnetised in the same direction (\figref{mup-sep-eq}).

\begin{figure}
\centering
\asyinclude{\jobname/multipole-sep}
\caption{Opposing multipole arrays with magnet separation $\mupfacegap$.}
\figlabel{mup-sep}
\end{figure}

\begin{figure}
\centering
\psfragfig{magcode/examples/magspring/fig/halbach-gaps}
\caption
[Multipole force characteristic with varying gaps between magnets.]
{
  The effect of magnet separation $\mupfacegap$ on the force characteristic of multipole arrays composed of nine cube magnets (\figref{mup-sep}).
  The dashed line is the force between an equivalent number of equally-sized and non-interacting pairs of magnets in repulsion (\eg, limiting case of \figref{mup-sep-eq2} as $\mupfacegap\to\infty$).
}
\figlabel{halbach-gaps}
\end{figure}


\begin{figure}
\centering
\subfloat[Multipole configuration.\figlabel{mup-sep-eq1}]{\asyinclude{\jobname/multipole-sep-eq}}\hfil
\subfloat[Homogeneous configuration.\figlabel{mup-sep-eq2}]{\asyinclude{\jobname/multipole-sep-eq2}}
\lofcaption{Opposing multipole arrays with too-large a separation.}{ In this case the second pair of arrays produces the greater forces since the magnets are too widely spaced to obtain the advantages of the multipole configuration.}
\figlabel{mup-sep-eq}
\end{figure}



\subsubsection{Conclusion to analysis of linear multipole arrays}

In conclusion, in optimising the forces between linear Halbach magnet arrays, it has been shown that there is an effect on the force \vs\ displacement characteristic from both the wavelength of magnetisation and the number of magnets in the array.
While keeping the array length constant, decreasing the wavelength of magnetisation increases the number of magnets per wavelength.
In order to achieve significantly larger forces over homogeneous magnetisation, a large number of magnets should be used.
When only a small number of magnets are used, small increases in the forces can be achieved by using magnets of non-uniform size.

The analysis undertaken in the section has demonstrated some design principles for multipole arrays for a certain aspect ratio.
There is still scope for further analysis of the force behaviour between multipole arrays of varying height-to-width (and perhaps height-to-wavelength) aspect ratios.


\section{Planar multipole arrays}
\seclabel{planar-multipole}

In \secref{optim-halbach-1d}, linear multipole arrays were considered in some detail for increasing magnetic spring forces.
The term `linear' is used to indicate that magnetisation is varying as a function of position in a single direction.
Using the magnet theory covered in \secref[vref]{magforce-arbitary}, it is also possible to calculate the forces between magnet arrays with magnetisation as a function of position in two directions.

Planar multipole arrays consist of a two dimensional stack of magnets that vary in magnetisation as a function of their position.
There are a number of different arrangements that have been considered; in the section to follow only those which use cuboid magnets are discussed due to the difficulty in analysing the forces between non-cuboid magnets.

The simplest case is the result of \SI{180}{\degree} magnetisation rotations in each direction \cite{kim1997-thesis,cho2001}.
The resultant magnetisation pattern looks like a checkerboard or `patchwork' (\figref{patchwork}).
From the analysis performed on linear multipole arrays in the previous section, it can be expected that the patchwork design, with only two magnets per wavelength of magnetisation, will produce forces less than what could be achieved with an alternate design.

Using cuboid magnets with \ang{0} or \ang{90} magnetisation directions is advantageous in that the magnets are readily available.
Several authors have examined the `quasi-Halbach' planar multipole array in which all magnetisation directions are restricted to one of the orthogonal directions of the axes \cite{moser2002-maglev,rovers2009-ietm,janssen2009-jsdd}, shown in \figref{quasi-halbach}.
Due to the symmetry of the pattern, there are regions within this multipole array of zero magnetisation.

\begin{figure}
\begin{wide}
\subfloat[Patchwork array, top view.\figlabel{patchwork}]{\quad\includegraphics[scale=1.2]{PhD/Figures/Multipole/patchwork}\quad}\hfil
\subfloat[Quasi-Halbach array, top view.\figlabel{quasi-halbach}]{\qquad\includegraphics[scale=1.2]{PhD/Figures/Multipole/quasi-halbach}\qquad}\hfil
\subfloat[Linear Halbach array.\figlabel{linear-halbach}]{\includegraphics{PhD/Figures/Multipole/pa-linear}}
\end{wide}
\caption[Three planar multipole array designs.]{Three planar multipole array designs, with strong sides facing `towards the reader' for the first two and `up' for the third. Note the (unfilled) areas of zero magnetisation in the quasi-Halbach array.}
\figlabel{two-planar-arrays}
\end{figure}

A more complex arrangement can be constructed by using superposition of orthogonal linear multipole arrays \cite[Appendix~A]{kim1997-thesis}.
Such a system, called here a `planar Halbach' array, is shown in \figref{trumper-system}, with five magnets per side and 90\textdegree\ magnetisation rotation in both the $\ax$--$\az$ and $\ay$--$\az$ planes between successive magnets.
This design requires magnets with \ang{45} magnetisation directions; it is possible to imagine superimposing designs with a greater number of magnets per wavelength to achieve even more complex magnetisation patterns.

\begin{figure}
\centerline{\includegraphics{PhD/Figures/Multipole/pa-trumper}}
\lofcaption{
  A planar Halbach array, facing up, with magnetisation directions as the superposition of two orthogonal linear Halbach arrays.
}{
  Non-filled arrowheads denote diagonal magnetisation and empty magnets have zero magnetisation.
}
\figlabel{trumper-system}
\end{figure}

Recent work in this area has suggested more complex structures for optimising the field strength or repulsion force generated by planar arrays, including using \threeD/ variations in magnetisation \cite{choi2008,choi2010-ietm}, triangular as well as rectangular cross-section magnets \cite{cho2001}, and using pyramidal-frustum-shaped magnets \cite{lee2006-mx,janssen2009-ietm} to stack with less empty space than the planar- or quasi-Halbach arrays.
A variation on the planar- and quasi-Halbach array has also been suggested \cite{min2010-ietm}.
There is insufficient scope in the current work to compare the broad range of possibilities available.
An example is shown demonstrating a simple comparison between the more straightforward arrays.

\subsection{Equations describing planar magnetisation patterns}

Planar magnet arrays are composed of $N_x\times N_y$ magnets each with magnetisation vector $\magM_{ij}$ for $i\in\{1\dots N_x\}$ and $j\in\{1\dots N_y\}$.
The planar designs have periodic magnetisations as functions of $i$ and $j$, which are described as follows in terms of normalised magnetisation $\magN = \magM/\remanence$, where $\remanence$ is the remanence magnetisation of the magnet.
For example, the normalised magnetisation of a homogeneous magnet aligned vertically facing up would be $\magN=\inlinevect{0,0,1}\T$.
In the equations to follow, the arrays are assumed to be aligned in the $\ax$--$\ay$ plane with their magnetic field extending largely into the $+\az$ direction (\ie, facing `up'); for arrays facing down in the $-\az$ direction, the normalised magnetisation in the $\az$ direction should have reversed sign.

\subsubsection{Patchwork array}

The patchwork array is only magnetised in the out-of-plane direction.
\begin{dmath}[compact]
\magN\fn{i,j} = \matr{}{0;0; \Cos{i\pi}\Cos{j\pi}} = \matr{}{0; 0; \gp{-1}^{i+j}}
\end{dmath}.

\subsubsection{Linear Halbach array}

A linear Halbach array has homogeneous magnetisation along one horizontal direction; in this case, the array is chosen to vary magnetisation along the $\ax$ direction (\ie, $N_y=1$).
\begin{dmath}[label=linear-halbach]
\magN\fn{i} = \matr{}{\Cos{\mupmagpol+\mupmagrot\gp{i-1}}; 0; \Sin{\mupmagrot+\mupmagrot\gp{i-1}}}
\end{dmath},
where $\mupmagpol$ is the magnetisation direction of the first magnet in the $\ax$--$\az$ plane and $\mupmagrot$ is the magnetisation rotation per magnet.
\Eg, for the linear Halbach array shown in \figref{linear-halbach} where $\mupmagpol=\ang{90}$, $\mupmagrot=\ang{90}$, and $N_x=5$ (and $i=1$ starts from the left), the normalised magnetisation vectors for each magnet are shown in \tabref{linear-halbach-magn}.

\begin{table}
\caption{Calculated normalised magnetisation vectors using \eqref{linear-halbach} for the linear Halbach array shown in \figref{linear-halbach}.}
\tablabel{linear-halbach-magn}
\begin{tabular}{>{$}c<{$}>{$}c<{$}>{$}c<{$}}
\toprule
i & \mupmagpol+\mupmagrot\gp{i-1} & \magN\T \\
\midrule
1 & \ang{90} & \inlinevect{0,0,+1} \\
2 & \ang{180} & \inlinevect{-1,0,0} \\
3 & \ang{270} & \inlinevect{0,0,-1} \\
4 & \ang{0} & \inlinevect{+1,0,0} \\
5 & \ang{90} & \inlinevect{0,0,+1} \\
\bottomrule
\end{tabular}
\end{table}

\subsubsection{Planar Halbach array}

In the planary Halbach array, the \emph{directions} of magnetisation are found from the superposition of two orthogonal linear Halbach array magnetisations,
\begin{dmath}
\magN\fn{i,j} = \matr{}{\Cos{\mupmagpolx+\mupmagrot\gp{i-1}} ; \Cos{\mupmagpoly+\mupmagrot\gp{j-1}} ; \Sin{\mupmagpolx+\mupmagrot\gp{i-1}} + \Sin{\mupmagpoly+\mupmagrot\gp{j-1}}}
\end{dmath},
where $\mupmagpolx$ and $\mupmagpoly$ are the directions of magnetisation of the initial magnet in the $\ax$--$\az$ and $\ay$--$\az$ planes, \resp.
However, as written this results in certain magnets having greater than unity normalised magnetisation, which implies that stronger than regular magnets would be required.
Therefore, care must be taken when using this equation to ensure that the vectors for the magnetisations for each magnet are normalised.

\subsubsection{Quasi-Halbach array}

Finally, for simplicitly assume for the quasi-Halbach array that the magnetisation vector for the initial magnet is in the $+\az$ direction as shown in \figref{quasi-halbach} (bottom left corresponds to $i=j=1$).
The magnetisation function for each magnet in the array is given by
\begin{dmath}
\magN\fn{i,j} = \matr{}{
  \Sin{\half\pi i} \Cos{\half \pi j} ;
  \Cos{\half\pi i} \Sin{\half \pi j} ;
  \Sin{\half\pi i} \Sin{\half \pi j} ;
}
\end{dmath}.

\subsection{Example comparison between planar arrays}

When pairs of arrays are faced in opposition, a vertical force is produced between them that can be larger than the corresponding force between two equivalently-sized magnets with homogeneous magnetisation.
Each array configuration has a different magnetic field pattern and has a different force/displacement profile.
Force--displacement characteristics for the quasi-Halbach array have been shown recently \cite{janssen2009-jsdd} but it should be noted that an analysis of the forces generated between planar Halbach arrays has not yet been shown in the literature.
Since the planar Halbach array uses magnetisations in directions non-orthogonal to its axes, the necessary calculations are more complex than for the quasi-Halbach array.

The vertical force \vs\ vertical displacement characteristics of each array considered (linear Halbach, planar Halbach, patchwork, and quasi-Halbach) are compared in \figref{planar-compare}, all with the same array size and volume.
The linear Halbach, planar Halbach, and quasi-Halbach have all been chosen to have a single wavelength of magnetisation with an end magnet for symmetry.
The linear Halbach array follows the same arrangement analysed in \secref{optim-halbach-1d} with long sides in the axis orthogonal to the plane of magnetisation (\figref{linear-halbach}).
The forces between two single magnets (of the same size as the arrays) are included for comparison.
Each array has the same outer dimensions of $\SI{50x50}{mm}$, thickness \SI{10}{mm}, and is composed of magnets with magnetisation \SI{1}{T}, and each magnet is either cube-shaped or, for the linear array, has a square cross-section.

It is interesting that the linear array exhibits the greatest force for a given displacement; this can be explained by the fact that the planar array and the quasi-Halbach array both have regions of zero magnetisation; this degrades their load-bearing ability since there is less inherent magnetic energy in each.
These results indicate that for this comparison the linear Halbach array is the most suitable choice for bearing vertical loads; not only are the forces stronger, but the magnetisation arrangement (and hence construction of the array) is simpler as well.

It is also notable that despite the much simpler magnetisation pattern of the quasi-Halbach array compared to the planar Halbach array, the results for these two are quite similar, especially at small displacements.
For these two arrays, greater forces can be achieved by reducing the amount of non-magnetised material in the design.
For the quasi-Halbach design, this can be performed by using a non-uniform magnet size as analysed for the linear case (\secref*{quasi-ratio}).
Greater improvements than for the linear case can be expected for the planar array as decreasing the magnet size ratio also decreases the amount of non-magnetic material in the design \cite{rovers2009-ietm,janssen2009-jsdd}.
For the planar Halbach array, the volume of non-magnetic material can be decreased by using a larger number of magnets per wavelength, albeit with an increase in the number of unique magnetisation directions required for each magnet in the array.

Finally, it is not strictly fair to compare the patchwork array to the others in this manner since the wavelengths of magnetisation differ between the arrays.
In all cases, optimisation of the magnet forces for this particular array volume and/or aspect ratio could be considered separately and different results may be seen.
\textcite{janssen2012-pier} have also shown the advantages of using pairs of magnet arrays in which the floating array is composed of smaller magnets with different magnet separation than in the fixed array.

However, it must be noted that these results differ from the experimental results of diamagnetic levitation \cite{moser2002-maglev} and from another theoretical study which uses an alternate theory for calculating the forces \cite{campbell2002}.
It is possible that the effect on the magnetisation of each magnet due to the magnetic field of the other magnets in the array, which is assumed to be negligible, actually has a measureable effect in practice.
These differences highlight the need to study these systems in more detail outside of the realm of theoretical analysis.

\begin{figure}
\begin{wide}
\subfloat[\num{5x5} magnets; face area \SI{50x50}{mm}.]{\psfragfig{magcode/examples/planar_compare/fig/planar-compare}}\hfil
\subfloat[\num{9x9} magnets; face area \SI{90x90}{mm}.]{\psfragfig{magcode/examples/planar_compare/fig/planar-compare-large}}
\end{wide}
\lofcaption{Vertical forces \vs\ vertical displacement between the array centres to compare the load-bearing ability of a range of magnet arrays.}{
Two sizes of array are compared, each composed of multiple \SI{10}{mm} \SI{1}{T} cube magnets.
The dashed vertical line indicates the displacement at which the array faces are in contact.}
\figlabel{planar-compare}
\end{figure}

\subsection{Forces due to horizontal displacement}
\seclabel{multipole-coupling}

The sensitivity of multipole arrays to horizontal displacement, such as shown in \figref{mup-hdispl}, is an important consideration for levitation purposes.
For homogeneous magnets, the coupling between horizontal displacement and vertical force was shown to be relatively small (\secref*{coupling}).
For multipole arrays, it is dependent largely on the wavelength of magnetisation; the smaller that is, the more cross-coupling there will be.

\begin{figure}[p]
\asyinclude{\jobname/halbach-hdispl}
\caption{Linear multipole system with five magnets (end view) depicting horizontal displacement $\muphdispl$ and vertical displacement $\mupvdispl$ between the array centres.}
\figlabel{mup-hdispl}
\end{figure}

The characteristic of this cross-coupling varies significantly between array designs.
An example of this is shown in \figref{planar-horiz} for three multipole arrays under horizontal displacement with total size \SI{50x50x10}{mm}, four \SI{1}{T} magnets per wavelength of magnetisation, and fixed $\mupvdispl=\SI{15}{mm}$ vertical displacement between the array centres.
Since the linear Halbach array is the only array considered which is not symmetrical in the horizontal plane, the vertical forces are considered due to displacements in both $\ax$ and $\ay$ directions (\figref{planarh-linear,planarhx-linear}).
The planar Halbach and the quasi-Halbach coupling characteristics (\figref{planarh-halbach,planarh-quasi}) are calculated due to horizontal displacement $\muphdispl$ in the $\ay$ direction only; the results are identical in the $\ax$ direction.

\begin{figure}
\begin{wide}
\subfloat[Linear Halbach arrays.\figlabel{planarh-linear}]{\psfragfig{magcode/examples/planar_compare/fig/planarh-linear}}\hfil
\subfloat[Linear Halbach arrays, $\muphdispl=0$ (out-of-plane).\figlabel{planarhx-linear}]{\psfragfig{magcode/examples/planar_compare/fig/planarhx-linear}}

\subfloat[Planar Halbach arrays.\figlabel{planarh-halbach}]{\psfragfig{magcode/examples/planar_compare/fig/planarh-halbach}}\hfil
\subfloat[Quasi-Halbach arrays.\figlabel{planarh-quasi}]{\psfragfig{magcode/examples/planar_compare/fig/planarh-quasi}}
\end{wide}
\lofcaption
{Force \vs\ horizontal displacement results between linear and planar multipole arrays of total size \SI{50x50x10}{mm}.}{ Vertical displacement $\mupvdispl=\SI{15}{mm}$; the $\ax$ forces are all zero.}
\figlabel{planar-horiz}
\end{figure}

The horizontal coupling behaviour for the linear Halbach design is significant in that the negative stiffness in the `out-of-plane' $\ax$ direction (orthogonal to the plane of magnetisation) is less than in the $\ay$ direction.
Comparing these results to the planar and quasi-Halbach arrays, the negative stiffness for those (equal in each direction) is approximately mid-way between the two negative stiffnesses in each direction of the linear-Halbach array.
Relatedly, the horizontal forces for the planar and quasi-Halbach arrays are around half the magnitude of the vertical forces, whereas for the linear Halbach array the forces in the $\ay$ direction are close to the magnitude of the vertical forces.

It is interesting to note that the vertical force for the planar Halbach array is largely positive, even as the arrays shift by half a wavelength, whereas the linear Halbach and quasi-Halbach forces are more symmetrical and become significantly negative under a similar displacement.
The effect of this is that the vertical force peak for the planar Halbach array is broader than the others, which will therefore be more suitable for cases where some horizontal displacement is expected and the vertical force variation must be minimised.

In fact, since the planar Halbach array has the broadest peak, this suggests that adding multiple pairs of planar Halbach arrays to a system with certain horizontal offsets (\figref{mup-2planar}) may allow a decrease in the amount of cross coupling in the system.
Force results for such a system are shown in \figref{double-halbach} for a relative offset of 90\% of one magnet width (chosen by trial-and-error in this case but could be chosen using an optimisation routine).
With a net doubling of the total magnet volume, the vertical load bearing capacity is unchanged; however, the variation of the load force with horizontal displacement is significantly decreased.
Such a system has an increased working range of horizontal displacement before force cross-coupling becomes an issue.

\begin{figure}
\centering
\asyinclude{\jobname/double-planar}
\lofcaption{Double \num{5x5} planar Halbach design in which complementary horizontal offsets $\muphdgap$ are imposed to decrease the cross-coupling stiffness.}{ Side-view shown; see \figref{trumper-system} for the isometric view of a single planar Halbach array.}
\figlabel{mup-2planar}
\end{figure}


\begin{figure}
\psfragfig{magcode/examples/planar_compare/fig/double-halbach}
\caption
  [Force \vs\ horizontal displacement results between a pair of double-Halbach multipole arrays.]
  {Force \vs\ horizontal displacement results between a pair of double-Halbach multipole arrays (\figref{mup-2planar}) with an offset $\muphdgap$ 90\% of one magnet width.
  Dashed lines show the vertical force contribution by each individual planar Halbach array.}
\figlabel{double-halbach}
\end{figure}

\section{Multipole conclusions}

This self-contained chapter contains work touching on the diverse field of multipole magnetic arrangements and formalising the theory for calculating forces between multipole arrays using cuboid magnets with arbitrary magnetisations.
The theory presented in previous chapters was abstracted for the purposes of analysing multipole arrays, and analysis was performed on linear and planar `Halbach arrays' for assessing their potential for increasing the load-bearing capacity of a magnetic spring.
Differences with results in the literature suggests further experimental work should be conducted to establish shortcomings in the theory used for numerical simulations.

The parameters for designing the multipole arrays are critical in achieving useful improvements, and there are certain caveats with using such designs.
Primarily, it must be noted that multipole designs will be more sensitive to lateral displacements, leading to higher levels of cross-coupling instability than homogeneous magnets.
Multipole arrays are best used for devices with restricted degrees of freedom or sufficient control authority for stabilising the inherent instabilities in the device.
Nonetheless, it has been shown that it is possible to increase the region of useable horizontal mobility using `offset' pairs of Halbach arrays.

\end{document}



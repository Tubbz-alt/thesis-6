%!TEX root = thesis.tex

\chapter{Prototype low-stiffness magnetic spring}
\chaplabel{xpmt}

\chapterprecis{
  And finally, some experiments that use magnets and measure vibrations. First, I
  describe the rig and other implementation details, including various tangents
  on appropriate sensor types and future designs that could be implemented
  in the future. Experimental results from the rig that was commissioned are
  presented, demonstrating the `\qzs' design where the resonant frequency
  of a passive system is reduced with attractive magnets, and further
  improvements gained from applying standard velocity feedback control.
}

This chapter covers the implementation details, experiments performed,
and results obtained from the experimental apparatus built for this
project.

\section{Design of the experimental apparatus}

\subsection{Overview of the experimental rig}

A schematic of the experimental apparatus that was designed and built as part
of this project is shown in \figref{rig}. Physical parameters of the design
are shown in \tabref{rigprop}. The experimental rig was built to serve as a
platform for investigating the dynamics of a simple system supported by
magnets with varying stiffnesses; specifically, for instantiating the ideas
behind the \qzs\ arrangement analysed in detail in \secref{qzs}.

\begin{figure}
  \asyfig{Rig/rig-schematic}
  \caption{Schematic of the experimental rig (not to scale). Position shown is the marginally stable configuration with equal gap between the lower and upper pairs
  of magnets.}
  \figlabel{rig}
\end{figure}


\begin{table}
\caption{Physical properties of the experimental rig.}
\tablabel{rigprop}
\begin{tabular}{@{}lcc@{}}
\toprule
                   Property &              Symbol &         Value \\
\midrule
                  Beam mass &         $\MassBeam$ & \SI{  0}{kg} \\
                Beam length &       $\LengthBeam$ & \SI{320}{mm} \\
                Beam height &       $\HeightBeam$ & \SI{ 25}{mm} \\
                 Beam width &        $\WidthBeam$ & \SI{ 40}{mm} \\
             Beam thickness &    $\ThicknessBeam$ & \SI{  2}{mm} \\
       Beam vertical offset &       $\OriginBeam$ & \SI{ 82}{mm} \\
\midrule                                            
      Magnet support height & $\HeightRigMagnets$ & \SI{ 105   }{mm} \\
   Magnet support lever arm & $\LengthRigMagnets$ & \SI{ 300   }{mm} \\
        Magnet support mass &   $\MassRigMagnets$ & \SI{  87   }{g}  \\
             Magnets height &        $\HeightMag$ & \SI{   9.5 }{mm} \\
           Magnets diameter &          $\DiamMag$ & \SI{  12.7 }{mm} \\
  Lower fixed magnet origin &     $\OriginMagLow$ & \SI{  44   }{mm} \\
  Upper fixed magnet origin &    $\OriginMagHigh$ & \SI{  30   }{mm} plus offset \\
\midrule
  Sensor height & $\HeightSensor$ & \SI{85}{mm} \\
  Sensor horizontal offset & $\LengthSensor$ & \SI{252}{mm} \\
  Sensor displacement measurement & $\DisplSensor$ & \SI{43}{mm}--\SI{53}{mm} \\
\bottomrule
\end{tabular}
\end{table}

The rig therefore consists of an arrangement of magnets, of which two are
fixed to the frame; the floating magnets are supported by these of which one
is situated below to apply a repulsive force (positive stiffness) and the
other is situated above to apply an attractive force (negative stiffness).
The physical location of the fixed magnets may be moved in order to vary the
respective amounts of positive and negative stiffness.

The magnet system is designed to look at dynamics in the vertical displacement
direction; having stability in this direction implies instability in the
horizontal direction (as discussed in \secref{earnshaw}). In order to remain
stable, the magnets require a physical constraint, which role is performed by
placing the floating magnets at the end of a long pinned rigid beam. Small
rotations of this beam can be assumed to correspond to largely vertical
displacements of the end magnets.

Having a physical constraint on the motion of the floating magnets compromises
the non-contact idea of using magnets for vibration isolation. This
experimental rig is only design to analyse the behaviour of the system in
terms of vertical translational disturbances. For a completely non-contact
system, a control system with electromagnets may be used to apply the
horizontal constraint (also see \secref{coupling}).

\subsection{Magnets}

\KJMagnetics \note{\url{http://www.kjmagnetics.com/}} is an American supplier
of rare earth magnets, which are available in a wide variety of geometrical
shapes. They offer a large range of sizes, \eg, from one-sixteenth inch cubes
(100 for \textsc{us\$}6.00) to one inch cubes, (\textsc{us\$}14.85 each), and
even larger. \note{Prices correct as of April 2009.} Price has an
approximately linear relationship with magnet volume, as shown in the graph of
magnet volume versus price in \figref{mag-price}.

\begin{figure}
  \psfragfig{\phdpath Magnets/latex/mag-price}
  \caption{Magnet price versus magnet volume for rare earth magnets.
    Data obtained from \KJMagnetics\ for cube magnets of magnetisation grade \acro{N42}.}
  \figlabel{mag-price}
\end{figure}

The magnets used for the experimental apparatus were chosen based on ease of
availability and construction. Cylindrical magnets were used of dimensions
$\mbox{\diameter}\,\SI{12.7}{mm}\times\SI{9.5}{mm}$ and material properties as
shown in \tabref{magnet-prop}.

\begin{table}
  \caption{Material properties for the magnets in the experimental apparatus.
    Magnet properties taken as minimum grade values from \KJMagnetics.}
  \tablabel{magnet-prop}
  \begin{tabular}{@{}lc@{}}
    \toprule
    Diameter & \SI{12.7}{mm} \\
    Height   & \SI{9.5}{mm}  \\
    Grade    & \acro{N42} \\
    Remanence & \SI{1.3}{T} \\
    Intrinsic coercivity & \SI{960}{kA/m} \\
    Maximum energy product & \SI{325}{kJ/m^3} \\
    \bottomrule
  \end{tabular}
\end{table}

Cylindrical magnets were chosen for their ease of integration into the
construction of the rig; \eg, it is much easier to fix a cylindrical magnet
into an object by boring a round hole as opposed to milling a square one. A
cylindrical magnet with slightly greater diameter than height was chosen in
order to match the force vs. distance characteristic with that of a cuboid
magnet; it can be shown that the force between two inline magnets is the same
for both cube shapes of a certain height and for cylinders with that same
height and equal face area, such as shown in \figref{equal-area}.

\begin{figure}
  \asyfig{Magnets/equal-area}
  \caption{A circle and square of equal area (to scale).}
  \figlabel{equal-area}
\end{figure}

For cylindrical magnet of diameter \SI{12.7}{mm}, the side length required to
achieve the same force curve as a cube magnet is \SI{11.3}{mm}, which is
somewhat larger than that of the actual magnet sourced for the apparatus.
However, it is was as close as possible to the desired size, and other factors
involved in the design (misalignment of the magnet centres, for example) will
act to reduce the total force slightly. For the purposes of the later
simulations (\fixme{crossref}), the magnetic forces will be assumed to be
generated by cube magnets of side length \SI{9.5}{mm}.

\subsection{Actuators}
\seclabel{actuators}

Actuators for the device were desired that could apply their forces in a
noncontact manner; even better would be actuators that do not add stiffness or
mass to the isolation platform, in order to highlight the dynamics of the
magnetic support as much as possible. Electromagnets were the obvious choice
to satisfy this requirement. \fixme{fill out some more}

A secondary requirement for the electromagnetic actuator was to keep it inline
with the load-bearing magnets. This better suits a future application of this
arrangement for an apparatus built to support multiple degrees of freedom.

Electromagnetic actuators are usually designed in push-pull configurations,
\textcite{nandi2009} demonstrate a single-sided design in which a bias current
is used to keep the structure in permanently `sprung' position; relaxing the
current is the equivalent of a repulsive force, while increasing the current
is the usual `pull' or attractive force of a regular electromagnetic actuator.
This design is relatively inefficient since it requires a continuous energy
expenditure to remain in equilibrium.

An alternative single-sided design that could be investigated is described
here. Rather than a coil and iron setup, the floating element could be a
permanent magnet; changing the direction of the current flowing in the coil
would then produce an alternating force on the magnet. \fixme{crossref and cite}

The dual-coil electromagnetic arrangement described in \secref{dualcoil} was
custom-built for the actuator for the experimental apparatus. A schematic of
the dual coil is shown in \figref{rig-dual-coil} with parameters in
\tabref{coil-prop}. The coil was designed to have an impedance of
\SI{8}{\ohm}, from which outer radius of the coil was calculated given a
certain wire diameter and resistance.

\begin{figure}
  \asyfig{Rig/rig-coil}
  \caption{Schematic of the dual coil electromagnet built for the experimental apparatus. (Not to scale.)}
  \figlabel{rig-dual-coil}
\end{figure}

\begin{table}
  \caption{Dual-coil electromagnet parameters.}
  \tablabel{coil-prop}
  \begin{tabular}{@{}lcc@{}}
    \toprule
    Magnet radius & $\RadiusMag$ & \SI{6.4}{mm} \\
    Magnet height & $\HeightMag$ & \SI{9.5}{mm}  \\
    \midrule
    Coil height & $\HeightCoil$ & \SI{7}{mm} \\
    Coil inner radius & $\RadiusICoil$ & \SI{10}{mm} \\
    Coil outer radius & $\RadiusOCoil$ & \SI{10.7}{mm} \\
    Coil gap & $\GapCoil$ & \SI{7}{mm} \\
    Turns (approx.) & & \num{105} \\
    \bottomrule
  \end{tabular}
\end{table}

The dimensions of the coil were chosen based on the trends shown in the
analytical calculations from \secref{dualcoil}. A force vs.\ displacement
curve of this particuar coil is shown in \figref{2coils-normdesign}; from this
graph, it can be seen that around the centred position (displacement of zero
in the curve), the force imparted by the coil remains within 10\% of maximum
around a displacement range of around \SI{\pm2}{mm}.

\begin{figure}
  \psfragfig{\phdpath Coil/fig/2coils-normdesign}
  \caption{Normalised force vs.\ displacement curve for the dual coil electromagnet.}
  \figlabel{2coils-normdesign}
\end{figure}

\subsection{Sensors}

The requirements for the sensing equipment is similar to that
of the actuators; noncontact spatial measurement is desired
to remove any possibility of adding further dynamics to the system.

There are four main choices for non-contact distance sensing,
enumerated below. See \textcite{boehm1993} for a more detailed overview.
\begin{description}
\item[Ultra-sonic] 
    These sensors work by sending out modulated
    ultra-sonic pulses to be reflected off the target. The time spent
    in the round trip gives a linear indicator of the
    distance. Ultra-sonic sensors are cheap, but slow and
    inaccurate. They are unsuited for use in this project.
\item[Inductive] 
    An inductive, or Hall effect, sensor works by
    exciting a coil with a high frequency sinusoidal current which
    induces eddy currents in the target.  These eddy currents may be
    measured very accurately, but the whole effect is very dependent
    on a lack of magnetic noise. This makes these type of sensors
    difficult to use in magnetic applications.
\item[Capacitive] 
    A capacitive sensor measures the capacitance
    between a plate and the target.  It can be very accurate and quite
    fast. To measure large distances, however, a large capacitive head
    is required (approx.\ $1$\,cm diameter for every $1$\,mm of
    range.) They are also very expensive due to the conditioning
    electronics required.
\item[Laser] 
    A laser sensor uses interferometry to calculate position
    of the target. For their price, they offer very good accuracy and
    speed; also, they do not suffer from electrical noise.
\end{description}

The sensor purchased for the experimental apparatus was a Wenglor~05\,MGV\,80
opto-electronic sensor, which uses a laser to measure distance over a
range of \SI{10}{mm}. It was selected for its convenient availability,
flexibility of application, and good performance characteristics.
Relevant operating properties are listed in \tabref{wenglor}.

\begin{table}
  \caption{Some properties of the Wenglor~05\,MGV\,80 laser distance sensor.}
  \tablabel{wenglor}
  \begin{tabular}{@{}lc@{}}
    \toprule
    Measurement offset & \SI{43}{mm} \\
    Measurement range & \SI{10}{mm} \\
    \midrule
    Working range & \SI{43}{mm}--\SI{53}{mm} \\
    Output range & \SI{10}{V}--\SI{0}{V} \\
    \midrule
    Resolution & $<\SI{10}{\micro m}$ \\
    Response time & \SI{0.5}{ms} \\
    \bottomrule
  \end{tabular}
\end{table}

\subsection{Physical/geometric design}

The main mass of the vibrationary component of the rig is composed of a
rigid square cross-section beam. This beam is used to constrain the system
of moving magnets to motion in a single degree of freedom. After taking a small
approximation, this motion can be assumed to be largely linear in the vertical
direction. This assumption is verified in \secref{coil-design}.

The beam itself was chosen as a rectangular section in order to minimise
weight and maximum stiffness; the beam is assumed to be a rigid body for the
purposes of these experiments (especially at the low vibrational frequencies 
under investigation).

Having established that the rotational system imposes a linear constraint on
the system under small enough displacements, it is better to examine the
response of the system as if it were a linear system. This involves writing
the dynamics of the system in terms of rotational motion and coercing the
variables into linear ones using a small angle approximation.

The rotational equation of motion for the beam--magnet system, neglecting
damping, is given by
\begin{dmath}[label=rig-moment-dynamics]
  \InertiaMomentTotal \ddot\AngleMag - \MomentMag = 0
\end{dmath},
where $\InertiaMomentTotal$ is the total moment of inertia of the motional
system, $\ddot\AngleMag$ is the angular acceleration, and $\MomentMag$ is the
moment applied due to the magnetic forces.

But the system has been designed such that the rotation of the system is
small and the motion at the magnets-end of the beam can be considered to be 
constrained in the vertical translational direction alone. The equation of motion
is re-written in terms of vertical displacement, $\DispMag$, arising from the
small angle approximation of $\AngleMag$. 
That is, 
\begin{dmath}[compact]
\AngleMag\approx\Sin{\AngleMag}=\DispMag/\LengthRigMagnets
\end{dmath}.
The moment on the beam due to the magnet force is 
$\MomentMag=\LengthRigMagnets\ForceRigMagnets$; \eqref{rig-moment-dynamics} can
be re-written as
\begin{dmath}[label=rig-force-dynamics]
  \frac{\InertiaMomentTotal}{\LengthRigMagnets^2}\ddot\DispMag 
    - \ForceRigMagnets = 0
\end{dmath}.

\subsubsection{Moment of inertia calculation}

A rectangular cross-section with a centre of rotation around a point offset in
one direction is shown in \figref{moment-of-inertia}. The moment of inertia in
the $x$--$y$ plane of such a cross section, of length $\BlockInertiaLength$
and height $\BlockInertiaHeight$, and offset $\BlockInertiaOffset$ from the
midpoint in the $y$ direction is
\begin{dmath}[label=InertiaMoment]
  \InertiaMoment\fn{
    \BlockInertiaMass,
    \BlockInertiaLength,
    \BlockInertiaHeight,
    \BlockInertiaOffset} 
  = \frac{1}{12} 
    \BlockInertiaMass 
    \gp{ 4\BlockInertiaLength^2 + \BlockInertiaHeight^2 } 
    + \BlockInertiaMass \BlockInertiaOffset^2
\end{dmath}. \fixme{cite}

\begin{figure}
  \begin{subfigure}
    \asyfig{Rig/moment-of-inertia}
    \caption{Schematic for calculating the moment of inertia of a block that
    is not rotating around the midpoint of an edge.\figlabel{moment-of-inertia}}
  \end{subfigure}
  \begin{subfigure}
    \asyfig{Rig/moment-beam}
    \caption{Model of a square-cross section beam for calculating the moment 
      of inertia around the centre of rotation shown.
      \figlabel{moment-beam}}
  \end{subfigure}
  \caption{Diagrams for calculating moments of inertia.}
\end{figure}

The moment of inertia for a square-section beam, $\InertiaMomentBeam$, can be
calculated by applying \eqref{InertiaMoment} to the outer volume of the beam and subtracting the moment of inertia of the empty
space within it.
\begin{dgroup*}
\begin{dmath}
  \InertiaMomentBeam = 
    \InertiaMoment_{\text{outer}} - \InertiaMoment_{\text{inner}}
\end{dmath},
\intertext{where}
\begin{dmath}
  \InertiaMoment_{\text{outer}} = 
    \InertiaMoment\fn{\MassBeamOuter,
                      \LengthBeam,
                      \HeightBeam,
                      \half\HeightBeam-\ThicknessBeam}
\end{dmath},
\begin{dmath}
  \InertiaMoment_{\text{inner}} = 
    \InertiaMoment\fn{\MassBeamInner,
                      \LengthBeam,
                      \HeightBeam-2\ThicknessBeam,
                      \half\HeightBeam-\ThicknessBeam}
\end{dmath},
\intertext{and}
\begin{dmath}
  \MassBeamOuter = \DensityAluminium \LengthBeam \HeightBeam \WidthBeam
\end{dmath},
\begin{dmath}
  \MassBeamInner =
    \DensityAluminium \LengthBeam
      \gp{\HeightBeam-2\ThicknessBeam} \gp{\WidthBeam-2\ThicknessBeam}
\end{dmath}.
\end{dgroup*}

The total moment of inertia $\InertiaMomentTotal$ of the motional element of
the experimental rig is given by
\begin{dmath}
  \InertiaMomentTotal = \InertiaMomentBeam + \InertiaMomentMagnets
\end{dmath}.
The moment of inertia of the magnets and their supports,
$\InertiaMomentMagnets$, is assumed to contribute to the total moment of inertia
as a point mass, since they act at a large distance from the axis of
revolution over a small and little-changing range of displacements from the
axis.
\begin{dmath}
  \InertiaMomentMagnets = \MassRigMagnets \LengthRigMagnets^2
\end{dmath}

From the numbers tabulated in \tabref{rigprop}, the total moment of inertia
of the beam is calculated to be
\begin{dmath}[label=InertiaMomentTotal]
  \InertiaMomentTotal = \SI{0.0156}{kg.m^2}
\end{dmath}.

\subsubsection{Equivalent mass calculation}

From the moment of inertia of the beam, the `equivalent mass' $\EquivMassRig$
of the system can be calculated, which is that of the system as if the
arrangement of magnets had its mass concentrated at a single point:
\begin{dmath}[label=EquivMassRig,compact]
  \EquivMassRig
    \equiv \inlinefrac{\InertiaMomentTotal}{\LengthRigMagnets^2}
    = \SI{0.173}{kg}
\end{dmath}.
This equivalent mass figure will be used later \fixme{crossref} to estimate
the equivalent stiffness of the system in different configurations.

\subsection{Coil geometry}
\seclabel{coil-design}

The geometry of the coil was designed from theory developed in \secref{emforces}.
The separation required between the permanent magnets in order to incorporate
an inline coil for actuation lead the design of the minimum dimensions of the coil.
\note{Generally, the author feels that for anyone else this sort of design 
  would be acceptable to determine empirically — \ie, guess — but a  
  combination between understanding one's limitations of practical design and 
  a tendency of over-analysing insignificant details produced the work in this 
  section.}

A long, rigid square-section beam was used to constrain the magnets to motion
in the predominantly vertical direction. Due to vertical motion from the 
ground, the magnets moving on the arc of beam experience some small horizontal
motion. Since the magnet section is held inside the coil, enough
tolerance is necessary to avoid contact between the moving magnet and the fixed coil.
On the other hand, the smaller the inner radius of the coil, the greater the
forces imparted by the coil on the magnet.

A simplified geometry of the moving magnet arrangement is used to calculate
the minimum tolerance required to avoid contact with the coil as a function
of the vertical motion of the magnets. This geometry is shown in 
\figref{horiz-tolerance}, where the L-shaped magnet support is shown
in the `rest' position $\overline{OAB}$ and in a rotated position $\overline{OA'B'}$.

\begin{figure}
  \asyfig{Rig/horiz-tolerance}
  \caption{Geometry for calculating the horizontal tolerance of the inner
           dimensions of the coil.}
  \figlabel{horiz-tolerance}
\end{figure}

The horizontal displacement of the highest point after rotation, $x$, can be
calculated as a function of rotation angle $\theta$
\begin{dgroup}
\begin{dmath}
  x = h \Sin{\theta} + f
\end{dmath},
\begin{dmath}
  f = l - l \Cos{\theta}
\end{dmath},
\end{dgroup}
where $l$ is the horizontal length of the magnet arrangement, and $h$ is the 
vertical height.
This can be expressed in terms of the vertical displacement of the main beam,
$z$, with $\Sin{\theta}=z/l$ and using the trigonometric relationship $\Cos{\ArcSin{a}}=\sqrt{1-a^2}$:
\begin{dmath}
  x = h z / l + l - \sqrt{l^2-z^2}
\end{dmath}.

From the dimensions chosen for the rig, $l=\SI{300}{mm}$ and $h=\SI{78.5}{mm}$,
the minimum horizontal tolerance for a vertical displacement $z=\SI{1}{mm}$ is
\SI{0.26}{mm} and for $z=\SI{2}{mm}$ is \SI{0.53}{mm}. 
(The relationship between $x$ and $z$ being fairly linear for most values
of $l$ and $h$ with small ranges of $z$.)
This tolerance was judged to be small enough to allow a surrounding coil
without having a significantly diminished force characteristic from the air
gap required to avoid contact.

\section{Experimental results}

A number of measurements were performed using the experimental apparatus;
in the sections following, data recorded is presented for 
\begin{enumerate}
\item Magnet gap versus beam displacement;
\item Open loop frequency responses for a range of magnet gaps; and,
\item Velocity feedback in a single configuration.
\end{enumerate}

\subsection{Displacement calibration}

The upper magnet's position was varied until the limit of stability was
reached. The lower fixed magnet was kept fixed, which means that the position
of \qzs\ was changing; with counter-threaded mounts for the upper and lower magnets, they could be adjusted in parallel to achieve a fixed \qzs\ location. 

As the upper magnet placement was lowered, the rest position of the beam moved
closer to the \qzs\ position (as more force was supported by the upper magnet).
This relationship is shown in \figref{turns-qzs}.
The normalised magnet gap is used in the following sections to
represent the varied configuration of the spring in the experiments.
From the geometry of the rig,
the position of the upper magnet was used to calculate the normalised magnet
gap between the magnets at \qzs:
\begin{dmath}
  \OriginMagGap =
    \half\gp{\HeightRig-\OriginMagLow-\OriginMagHigh-\HeightRigMagnets}
    +\HeightMag+\HeightBuffer
\end{dmath},
where geometrical properties are described in \tabref{rigprop} and 
$\HeightBuffer=\SI{2.5}{mm}$ is a little extra height to account for extra
space taken up by the beam shell thickness and the shell of the magnet mount.

\begin{figure}
  \psfragfig{\phdpath XPMT/latex/turns-qzs}
  \caption{Rest position of the system as the magnet position varies.}
  \figlabel{turns-qzs}
\end{figure}

\subsection{Open loop measurements}

As the position of the upper magnet is varied, the amount of negative
stiffness added to the system changes. This predominantly affects the rest
position and the resonance frequency, along with with small changes in damping.
Frequency response measurements were taken at a number of discrete locations
of the upper fixed magnet to observe the changes in dynamics as the rest 
position of the system approached the \qzs\ position.

Due to the low damping and low resonance frequency of the system, very long
sample times were required to achieve results with enough frequency resolution
and sufficient coherence to characterise the response. The parameters used to
perform the spectral analysis for each measurement are shown in
\tabref{rig-ol-spect}.

\begin{table}
  \begin{tabular}{@{}lc@{}}
    \toprule
      Sample rate        & \SI{1000}{Hz}           \\
      \FFT\ points       & $2^{16}$                \\
      Sample time        & $\approx$\SI{17.5}{min} \\
      Average overlap    & $0.75$                  \\
      Number of non-overlapping averages & $16$    \\ 
    \bottomrule
  \end{tabular}
  \caption{Parameters used in the signal and spectrum analysis for the
   experimental measurements.}
  \tablabel{rig-ol-spect}
\end{table}

Open loop measurements were taken both with and without the electromagnetic
actuator connected (wired up as both a short circuit and an open circuit). In
the closed circuit configuration, the coil adds damping via induced eddy
currents from the moving magnet. As an open circuit, the coil has no effect on
the dynamics of the system.

Open loop measurements without the coil connected are shown in
\figref{ol-undamped-frflin}. and measurements taken with the coil (\ie, with
added damping) shown in \figref{ol-damped-frflin}. For both of these results,
the transmissibility, \transmissibility, shown is the transfer function
between the accelerometer measurements of the base and magnet-supported beam:
\note{Calculated with \Matlab's \texttt{tfestimate} command.}
\begin{dmath}[label=Tbm]
  \transmissibility = \frac{\crossSpectMagnetBase}{\powerSpectBase}
\end{dmath}.

\begin{figure}[p]
  \psfragfig{\phdpath XPMT/latex/ol-undamped-frflin}
  \caption{Open loop measurements with the electromagnetic coil connected in
           an open circuit; no additional damping is added to the system.}
  \figlabel{ol-undamped-frflin}
\end{figure}

\begin{figure}[p]
  \psfragfig{\phdpath XPMT/latex/ol-damped-frflin}
  \caption{Open loop measurements, with the electromagnetic coil connected
           in a closed circuit. The coil adds damping to the system, which can
           be seen by the reduction in height of the resonant peaks in comparison 
           to \figref{ol-undamped-frflin}.}
  \figlabel{ol-damped-frflin}
\end{figure}

\subsection{Analysis of the open loop data}

From the measurements shown in the previous section, data fitting of the
frequency response functions was used to extract a linear model of the system
in each configuration.

The model used to fit the data is the simple system of vibration isolation,
\eqref{simple-isolation-freq} in terms of the resonant frequency, $\natfreq =
\sqrt{\stiffness/\mass}$, and damping ratio $\dampingratio = \damping /
(2\sqrt{\stiffness\mass})$. The resulting expression is
\begin{dmath}[label=fit-model]
  \transmissibility\fn{\freq} = \frac
    {2\ii\dampingratio\freq\natfreq + \natfreq^2}
    {-\freq^2 + 2\ii\dampingratio\freq\natfreq + \natfreq^2},
\end{dmath}
where $\freq$ is the frequency at which to calculate the transmissibility
$\transmissibility$. The data is fit \note{Using \Matlab's
\code{fminsearch}.} to \eqref{fit-model} between $\half\natfreq \le \freq
\le 2\natfreq$, returning good estimates of the resonance frequency and
damping ratio of the system corresponding to each measurement taken. Plots of
the curve fit models shown against the measured data are shown in
\figref{ol-undamped-frflin-fit,ol-damped-frflin-fit}. Due to the influence of
higher-order dynamics in the system, the model starts to deviate from the data
at higher frequencies. The resonance frequencies and damping ratios are shown
in \figref{ol-results}.

\begin{figure}[p]
  \psfragfig{\phdpath XPMT/latex/ol-undamped-frflin-fit}
  \caption{Curve fit model of \figref{ol-undamped-frflin}. Grey lines show the original data.}
  \figlabel{ol-undamped-frflin-fit}
\end{figure}

\begin{figure}[p]
  \psfragfig{\phdpath XPMT/latex/ol-damped-frflin-fit}
  \caption{Curve fit model of \figref{ol-damped-frflin}.  Grey lines show the original data.}
  \figlabel{ol-damped-frflin-fit}
\end{figure}

\begin{figure}
  \begin{wide}
  \begin{subfigure}
    \psfragfig{\phdpath XPMT/latex/ol-reson}
    \caption{Model-derived resonant frequencies\figlabel{ol-reson}}
  \end{subfigure}
  \begin{subfigure}
    \psfragfig{\phdpath XPMT/latex/ol-dampi}
    \caption{Model-derived damping ratio\figlabel{ol-dampi}}
  \end{subfigure}
  \end{wide}
  \caption{Analysed results from fitting the open loop measurements to the isolator model of \eqref{fit-model}.}
  \figlabel{ol-results}
\end{figure}

From \figref{ol-reson} it can be seen that the resonant frequency remains
unaffected by the presence of the electromagnetic coil (which can also be
observed by comparing \figref{ol-undamped-frflin,ol-damped-frflin}) but the
damping is increased significantly.


\subsection{Observed nonlinear behaviour}

The dynamics shown in the undamped case are more nonlinear than the damped
case; this is due to the greater displacements experienced by the beam moving
the magnets through greater ranges of stiffness variation. When the
transmissibility is calculated as the transfer function between the input and
output signals, the system is assumed to be linear and nonlinearities are
rejected by the ratio of the cross-spectrum and power-spectrum terms in
\eqref{Tbm}. A different result can be shown by calculating the
transmissibility instead with a ratio of the individual power spectra of the
base and magnet:
\begin{dmath}[label=frfnl]
  \transmissibility\fn{\freq} = \sqrt{\powerSpectMagnet/\powerSpectBase},
\end{dmath}
where $\powerSpectMagnet$ is the power spectra of the accelerometer
measurements at the moving magnet and $\powerSpectMagnet$ is the power spectra
of the accelerometer measurements of the base. In this case, any
nonlinearities in the signals are retained in the final result.

The transmissibility calculated with this method is shown in
\figref{ol-undamped-frfnl}. In this case, the nonlinearities present in the
system are more prominent, and a clear peak is shown at close to twice the
`natural' resonance frequency.

\begin{figure}
  \psfragfig{\phdpath XPMT/latex/ol-undamped-frfnl}
  \caption{Open loop measurements without the coil connected; the transmissibility is calculated with \eqref{frfnl}. Black markers show resonant frequencies and the points at twice each resonant frequency, indicating the higher-order dynamics.}
  \figlabel{ol-undamped-frfnl}
\end{figure}

\subsection{Velocity feedback results}

For this experiment, the rest position of the spring was chosen to some low
resonant frequency (approximately \SI{3.5}{Hz}) and velocity feedback applied
to the system. Sampling parameters are as shown previously in
\tabref{rig-ol-spect}.

In this position, the electromagnetic coil was used in a simple velocity
feedback controller in an attempt to reduce the height of the resonance peak.
The gain of the feedback control was increased until the system became close
to instability. Frequency response measurements over this range of feedback
gains are shown in \figref{cl-results}.

\begin{figure}
  \psfragfig{\phdpath XPMT/latex/cl-results}
  \caption{Closed loop measurements.}
  \figlabel{cl-results}
\end{figure}

To measure the velocity of the moving beam, the accelerometer measurement is
integrated by the charge amplifier with a cut-on frequency of \SI{1}{Hz}.
Because the accelerometers were now being used to measure velocity, the
transmissibility curves shown below were calculated from the ratio of the
velocity measurements instead.

Due to the presence of higher-order dynamics in the structure, a low pass
filter was used to reject signals above \SI{50}{Hz} \fixme{check!}.

The overall improvement to the vibration isolation can be shown by calculating
the root-mean-square of the transmissibility over a certain frequency range.
\begin{dmath}
  \transmissibility_{\textsc{rms}} = 
  \sqrt{\Sum{\transmissibility\fn{\freq}^2}{\freq,\freq_1,\freq_2}}
\end{dmath}
The results become very noisy in \figref{cl-results} below
$\freq_1=\SI{1}{Hz}$, so this is defined as our lower frequency
limit. The upper frequency limit $\freq_2=\SI{11}{Hz}$ is chosen
as the higher-order dynamics (not shown in \figref{cl-results}) have little
impact yet.

\Figref{cl-reduction} shows the reduction in `overall transmissibility'
$\transmissibility_{\text{RMS}}$ as the negative feedback gain increases. The
resonance appearing in the lower frequencies of \figref{cl-results} causes the
overall transmissibility reduction to have a local minimum.

\begin{figure}
  \psfragfig{\phdpath XPMT/latex/cl-reduction}
  \caption{Reduction in overall transmissiblity between \SI{1}{Hz} and \SI{11}{Hz}.}
  \figlabel{cl-reduction}
\end{figure}

\paragraph{The feedback gain magnitude} \Figref{cl-results,cl-reduction} plot
results in terms of a `feedback gain' given in dimensionless units. This gain
is the multiplier from the controller on the velocity signal that also
incorporates the effects of the amplifiers for both sensors and actuators;
therefore, the absolute magnitude of this number is unimportant and is used
purely to demonstrate the range of behaviours seen as the gain is increased
until instability appears.

\subsubsection{Analysis on the gain-induced resonance}

The appearance of a low frequency peak in \figref{cl-results} as the feedback
gain is increased is explained by the presence of the high-pass filter
incorporated in the accelerometer charge amplifier. This behaviour is shown by
\textcite{ananthaganeshan2001,brennan2007} for single degree of freedom
structures with velocity feedback. Here, the same type of analysis will be
used to investigate the response of a linear two degree of freedom isolator
system (shown in \figref{vibration-base-feedback}) with integrated
accelerometer measurements used for velocity feedback control.

\begin{figure}
  \asyfig{Systems/vibration-base-feedback}
  \caption{Vibration isolation schematic with active feedback.}
  \figlabel{vibration-base-feedback}
\end{figure}

In the time domain, the response of this linear system is given by
\begin{dmath}
\massMass \accelMass = 
  \forceIn - \damping\gp{\velMass-\velBase} - \stiffness\gp{\dispMass-\dispBase}
\end{dmath},
which can be re-written in the Laplace domain as
\begin{dmath}[label=simple-isolator-laplace]
s^2 \laplaceMass \underbrace{\gp{\massMass+\damping/s+\stiffness/s^2}}_{\gp{\Block[2]}^{-1}} = 
  \laplaceForce + s^2 \laplaceBase \underbrace{\gp{\damping/s+\stiffness/s^2}}_{\Block[1]}
\end{dmath}.
This is shown as a block diagram in \figref{simple-isolator-block}. If the
control force is written as a function of the acceleration of the mass,
$\laplaceForce=s^2\laplaceMass\BlockController$, the transmissibility of the system is
\begin{dmath}[label=cl-generic]
  \frac\laplaceMass\laplaceBase = \frac{\Block[1]\Block[2]}{1+\BlockController\Block[2]}
\end{dmath}.

\begin{figure}
  \asyfig{Control/simple-isolator-block}
  \caption{Block diagram of \eqref{simple-isolator-laplace} representing
  the system shown in \figref{vibration-base-feedback}.}
  \figlabel{simple-isolator-block}
\end{figure}

When the controller is some gain $\gain$ in series with an ideal integration
of the accelerometer signal, $\BlockController = \gain/s$, \eqref{cl-generic}
simplifies to the skyhook damping expression shown in \secref{skyhook}. This
result is plotted in \figref{cl-ideal} for equivalent values of stiffness and
damping as the experimental setup.

A more complex model for the controller block is required to account for the
signal processing involved with amplifying and filtering the accelerometer
signal to measure the velocity in reality. Assuming that the entire process
between acceleration measurement and velocity output from the charge amplifier
can be approximated as an ideal integrator in series with two high pass
filters\footnote{One filter for the integration of the acceleration signal,
another for the conditioning electronics in the amplifier; assume for
simplicity that they have the same cut-on frequency.} \parencite{brennan2007},
the controller block is defined as
\begin{dmath}[label=cl-filter-controller]
  \BlockController = \frac \gain s \gp{\frac{s}{s+\freqHPfilter}}^2
\end{dmath},
where $\gain$ is the feedback gain and $\freqHPfilter$ is the corner frequency of 
the high pass filter in the charge amplifier.

Using \eqref{cl-filter-controller} in \eqref{cl-generic} gives
the final transfer function between the mass and base states,
\begin{dmath}[label=cl-filter]
  \frac\laplaceMass\laplaceBase = 
    \frac{ \gp{\damping s+\stiffness} \gp{s+\freqHPfilter}^2 }
         { 
           \gain s^3 +
           \gp{ \massMass s^2 + \damping s + \stiffness }
           \gp{ s+\freqHPfilter }^2
         }
\end{dmath}.
This is plotted versus frequency in \figref{cl-filter}, where the resonance
induced by the high pass filter becomes apparent as the feedback gain is
increased to 99\% of the maximum gain (which is the gain when the system
becomes unstable). In order to calculate the maximum gain,
$\BlockController\Block[2]$ was split into real and imaginary parts and
evaluated to equal $-1$, where the system response becomes unbounded. In more
detail, first the critical frequency was found as the frequency at which
$\Imag{\BlockController\Block[2]}=0$; this frequency was then substituted into
$\Real{\BlockController\Block[2]}=1$, which was solved for the maximum gain.

\begin{figure}
  \begin{wide}
  \begin{subfigure}
    \psfragfig{\phdpath Simulations/Springs/fig/cl-ideal}
    \caption{Ideal velocity signal.\figlabel{cl-ideal}}
  \end{subfigure}
  \begin{subfigure}
    \psfragfig{\phdpath Simulations/Springs/fig/cl-filter}
    \caption{Integrated accelerometer feedback with a double high pass filter.\figlabel{cl-filter}}
  \end{subfigure}
  \end{wide}
  \caption{Closed loop simulation with gains $\{0, 5, 10, 20, 50, 99\}$ percent of the maximum gain before instability in \figref{cl-filter}.}
\end{figure}

Comparing \figref{cl-filter} with \figref{cl-results} shows a clear
similarity. The corner frequency of the high pass filter at \SI{1}{Hz} in the
charge amplifier to measure velocity is an impediment to the vibration
isolation properties of the feedback-controlled system. This potential
drawback could be mitigated with a different way to estimate the velocity of
the isolated beam; simply a higher-precision charge amplifier would probably
be acceptable.

\fixme{Would doing the integration in the computer help?}


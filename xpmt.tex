%!TEX root = thesis.tex

\chapter{Prototype low-stiffness magnetic spring}
\chaplabel{xpmt}

\chapterprecis{
  And finally, some experiments that use magnets and measure vibrations. First, I
  describe the rig and other implementation details, including various tangents
  on appropriate sensor types and future designs that could be implemented
  in the future. Experimental results from the rig that was commissioned are
  presented, demonstrating the `\qzs' design where the resonant frequency
  of a passive system is reduced with attractive magnets, and further
  improvements gained from applying standard velocity feedback control.
}

This chapter covers the implementation details, experiments performed,
and results obtained from the experimental apparatus built for this
project.

\section{Design of the experimental apparatus}

\subsection{Overview of the experimental rig}

The experimental apparatus that was designed and built as part of this project
is shown as a schematic in \figref{rig} and as a photograph in
\figref{rig-photo}. Physical parameters of the design are shown in
\tabref{rigprop}. The experimental rig was built to serve as a platform for
investigating the dynamics of a simple system supported by magnets with
varying stiffnesses; specifically, for instantiating the ideas behind the
\qzs\ arrangement analysed in detail in \secref{qzs}.

\begin{figure}
  \begin{wide}
    \asyfig{Rig/rig-schematic}
  \end{wide}
  \caption{Schematic of the experimental rig (not to scale). Position shown is the marginally stable configuration with equal gap between the lower and upper pairs of magnets.}
  \figlabel{rig}
\end{figure}

\begin{figure}
  \includegraphics[width=0.8\textwidth]{\phdpath Rig/photo.jpg}
  \caption{Photo of the experimental apparatus. Base shaker is not shown.}
  \figlabel{rig-photo}
\end{figure}


\begin{table}
\caption{Physical properties of the experimental rig.}
\tablabel{rigprop}
\begin{minipage}{\textwidth}
\def\footnoterule{}
\begin{tabularx}{\textwidth}{@{}Xll@{}}
\toprule
                Rig height  & $\HeightRig$ & \SI{209}{mm} \\
                  Beam mass &         $\MassBeam$ & \SI{266}{g}\thinspace
\footnote{Mass of the accelerometer is accounted for in this value.}  \\
                Beam length &       $\LengthBeam$ & \SI{320}{mm} \\
                Beam height &       $\HeightBeam$ & \SI{ 25}{mm} \\
                 Beam width &        $\WidthBeam$ & \SI{ 40}{mm} \\
             Beam thickness &    $\ThicknessBeam$ & \SI{  2}{mm} \\
       Beam vertical offset &       $\OriginBeam$ & \SI{ 82}{mm} \\
\midrule                                            
      Magnet support height & $\HeightRigMagnets$ & \SI{105  }{mm} \\
   Magnet support lever arm & $\LengthRigMagnets$ & \SI{300  }{mm} \\
        Magnet support mass &   $\MassRigMagnets$ & \SI{ 87  }{g}  \\
             Magnets height &        $\HeightMag$ & \SI{  9.5}{mm} \\
           Magnets diameter &          $\DiamMag$ & \SI{ 12.7}{mm} \\
  Lower fixed magnet origin &     $\OriginMagLow$ & \SI{ 44  }{mm} \\
  Upper fixed magnet origin &    $\OriginMagHigh$ & \SI{ 30  }{mm} plus offset\thinspace
  \footnote{Offset varied to adjust the amount of added negative stiffness.} \\
\midrule
  Sensor height & $\HeightSensor$ & \SI{85}{mm} \\
  Sensor horizontal offset & $\LengthSensor$ & \SI{252}{mm} \\
  Sensor displacement measurement & $\DisplSensor$ & \SI{43}{mm}--\SI{53}{mm} \\
\bottomrule
\end{tabularx}
\end{minipage}
\end{table}

The rig therefore consists of an arrangement of magnets, of which two are
fixed to the frame; the floating magnets are supported by these of which one
is situated below to apply a repulsive force (positive stiffness) and the
other is situated above to apply an attractive force (negative stiffness). The
physical location of the fixed magnets may be moved vertically in order to
vary the respective amounts of positive and negative stiffness.

The magnet system is designed to look at dynamics in the vertical displacement
direction; having stability in this direction implies instability in the
horizontal direction (as discussed in \secref{earnshaw}). In order to remain
stable, the magnets require a physical constraint, achieved by placing the
floating magnets at the end of a long pinned rigid beam. Small rotations of
this beam can be assumed to correspond to largely vertical displacements of
the end magnets. This is ensured in the design later in
\secref{rotating-beam}.

The beam itself was chosen as a hollow rectangular section in order to
minimise weight and maximise stiffness; it is assumed to be a rigid body
for the purposes of these experiments (especially at the low vibrational
frequencies under investigation).

Having a physical constraint on the motion of the floating magnets compromises
the non-contact idea of using magnets for vibration isolation. This
experimental rig is only design to analyse the behaviour of the system in
terms of vertical translational disturbances. For a completely non-contact
system, a control system with electromagnets may be used to apply the
horizontal constraint (also see \secref{coupling}).

\subsection{Magnets}

\KJMagnetics \note{\url{http://www.kjmagnetics.com/}} is an American supplier
of rare earth magnets, which are available in a wide variety of geometrical
shapes. They offer a large range of sizes, \eg, from one-sixteenth inch cubes
(100 for \textsc{us\$}6.00) to one inch cubes, (\textsc{us\$}14.85 each), and
even larger. \note{Prices correct as of April 2009.} Price has an
approximately linear relationship with magnet volume, as shown in the graph of
magnet volume versus price in \figref{mag-price}.

\begin{figure}
  \psfragfig{\phdpath Magnets/latex/mag-price}
  \caption{Magnet price versus magnet volume for rare earth magnets.
    Data obtained from \KJMagnetics\ for cube magnets of magnetisation grade \acro{N42}.}
  \figlabel{mag-price}
\end{figure}

The magnets used for the experimental apparatus were chosen based on ease of
availability and construction. Cylindrical magnets were used of dimensions
$\mbox{\diameter}\,\SI{12.7}{mm}\times\SI{9.5}{mm}$ and material properties as
shown in \tabref{magnet-prop}.

\begin{table}
  \caption{Material properties for the magnets in the experimental apparatus.
    Magnet properties taken as minimum grade values from \KJMagnetics.}
  \tablabel{magnet-prop}
  \begin{tabular}{@{}ll@{}}
    \toprule
    Diameter & \SI{12.7}{mm} \\
    Height   & \SI{9.5}{mm}  \\
    Grade    & \acro{N42} \\
    Remanence & \SI{1.3}{T} \\
    Intrinsic coercivity & \SI{960}{kA/m} \\
    Maximum energy product & \SI{325}{kJ/m^3} \\
    \bottomrule
  \end{tabular}
\end{table}

Cylindrical magnets were chosen for their ease of integration into the
construction of the rig; \eg, it is much easier to fix a cylindrical magnet
into an object by boring a round hole as opposed to milling a square one.

\begin{comment}
A cylindrical magnet with slightly greater diameter than height was chosen in
order to match the force vs. distance characteristic with that of a cuboid
magnet; it can be shown that the force between two inline magnets is the same
for both cube shapes of a certain height and for cylinders with that same
height and equal face area, such as shown in \figref{equal-area}.

\begin{figure}
  \asyfig{Magnets/equal-area}
  \caption{A circle and square of equal area (to scale).}
  \figlabel{equal-area}
\end{figure}

For cylindrical magnet of diameter \SI{12.7}{mm}, the side length required to
achieve the same force curve as a cube magnet is \SI{11.3}{mm}, which is
somewhat larger than that of the actual magnet sourced for the apparatus.
However, it is was as close as possible to the desired size, and other factors
involved in the design (misalignment of the magnet centres, for example) will
act to reduce the total force slightly. For the purposes of the later
simulations, the magnetic forces will be assumed to be
generated by cube magnets of side length \SI{9.5}{mm}.
\end{comment}

\subsection{Actuators}
\seclabel{actuators}

Actuators for the device were desired that could apply their forces in a
noncontact manner; even better are actuators that add neither stiffness nor
mass to the isolation platform, in order to highlight the dynamics of the
magnetic support as much as possible. Some manner of electromagnetic force 
was the obvious choice to satisfy this requirement.

Electromagnetic actuators are usually designed in push-pull configurations,
with fixed non-biased coils applying force on a moving ferrous material. Since
only attractive forces can be generated in this configuration, such
electromagnets must be used in pairs to achieve forces in two directions.

An alternative is to used biased electromagnets, such that either the coil
itself contains a permanent magnet, or the coil acts against a permanent
magnet, or both. For a biased coil, instability results due to the presence of
the negative stiffness attractive forces between the permanent magnet and the
ferrous moving material. In these cases, pairs of electromagnets are no longer
strictly necessary since the current in the coil may be reversed and a
repulsive force generated.

For example, \textcite{nandi2009} demonstrate a single-sided design in which a
bias current is used to keep the structure in permanently `sprung' position;
relaxing the current is the equivalent of a repulsive force, while increasing
the current is the usual `pull' or attractive force of a regular
electromagnetic actuator. This design is relatively inefficient since it
requires a continuous energy expenditure to remain in equilibrium.

Using a non-ferrous coil to apply forces to a moving permanent magnet,
however, is passively stable and requires no steady current for operation.
However, the forces applied by a coil to an external magnet are relatively
small; larger forces are achieved when the magnet can be inserted within the
coil itself. This suits a secondary requirement for the electromagnetic
actuator to keep it inline with the load-bearing magnets. This better suits a
future application of this arrangement for an apparatus built to support
multiple degrees of freedom. The ferrous-free coil and moving permanent magnet
approach was adopted for the choice of electromagnetic actuator for the rig,
as has already been shown in the schematic \figref[vref]{rig}

The dual-coil electromagnetic arrangement described in \secref{dualcoil} was
custom-built for the actuator for the experimental apparatus. A schematic of
the dual coil is shown in \figref{rig-dual-coil} with parameters in
\tabref{coil-prop}. The coil was designed to have an impedance of
\SI{8}{\ohm}, from which the outer radius of the coil was calculated given a
certain wire diameter and resistance.

\begin{figure}
  \begin{wide}
  \begin{sidefigure}
  \asyfig{Rig/rig-coil}
  \caption{Schematic of the dual coil electromagnet built for the experimental apparatus. (Not to scale.)
  \figlabel{rig-dual-coil}}
  \end{sidefigure}\hfill
  \begin{sidefigure}
  \psfragfig{\phdpath Coil/fig/2coils-normdesign}
  \caption{Normalised force vs.\ displacement curve for the dual coil electromagnet. Zero displacement is as shown in \figref{rig-dual-coil}, and
  negative displacements show symmetric behaviour to that shown here.
  \figlabel{2coils-normdesign}}
\end{sidefigure}  
  \end{wide}
\end{figure}

\begin{table}
  \caption{Dual-coil electromagnet parameters.}
  \tablabel{coil-prop}
  \begin{tabular}{@{}lll@{}}
    \toprule
    Magnet radius & $\RadiusMag$ & \SI{6.4}{mm} \\
    Magnet height & $\HeightMag$ & \SI{9.5}{mm}  \\
    \midrule
    Coil height & $\HeightCoil$ & \SI{7}{mm} \\
    Coil inner radius & $\RadiusICoil$ & \SI{10}{mm} \\
    Coil outer radius & $\RadiusOCoil$ & \SI{10.7}{mm} \\
    Coil gap & $\GapCoil$ & \SI{7}{mm} \\
    Turns (approx.) & & \num{105} \\
    \bottomrule
  \end{tabular}
\end{table}

The dimensions of the coil were chosen based on the trends shown in the
analytical calculations from \secref{dualcoil}. A force vs.\ displacement
curve of this particuar coil is shown in \figref{2coils-normdesign}; from this
graph, it can be seen that around the centred position (displacement of zero
in the curve), the force imparted by the coil remains within 10\% of maximum
around a displacement range of around \SI{\pm2}{mm}.

\subsection{Sensors}

The requirements for the sensing equipment is similar to that
of the actuators; noncontact spatial measurement is desired
to remove any possibility of adding further dynamics to the system.

There are four main choices for non-contact distance sensing,
enumerated below. See \textcite{boehm1993} for a more detailed overview.
\begin{description}
\item[Ultra-sonic] 
    These sensors work by sending out modulated
    ultra-sonic pulses to be reflected off the target. The time spent
    in the round trip gives a linear indicator of the
    distance. Ultra-sonic sensors are cheap, but slow and
    inaccurate. They are unsuited for use in this project.
\item[Inductive] 
    An inductive, or Hall effect, sensor works by
    exciting a coil with a high frequency sinusoidal current which
    induces eddy currents in the target.  These eddy currents may be
    measured very accurately, but the whole effect is very dependent
    on a lack of magnetic noise. This makes these type of sensors
    difficult to use in magnetic applications.
\item[Capacitive] 
    A capacitive sensor measures the capacitance
    between a plate and the target.  It can be very accurate and quite
    fast. To measure large distances, however, a large capacitive head
    is required (approx.\ $1$\,cm diameter for every $1$\,mm of
    range.) They are also very expensive due to the conditioning
    electronics required.
\item[Laser] 
    A laser sensor uses interferometry to calculate position
    of the target. For their price, they offer very good accuracy and
    speed; also, they do not suffer from electrical noise.
\end{description}

The sensor purchased for the experimental apparatus was a Wenglor 05\,MGV\,80
opto-electronic sensor, which uses a laser to measure distance over a
range of \SI{10}{mm}. It was selected for its convenient availability,
flexibility of application, and good performance characteristics.
Relevant operating properties are listed in \tabref{wenglor}.

\begin{table}
  \caption{Some properties of the Wenglor~05\,MGV\,80 laser distance sensor.}
  \tablabel{wenglor}
  \begin{tabular}{@{}ll@{}}
    \toprule
    Measurement offset & \SI{43}{mm} \\
    Measurement range & \SI{10}{mm} \\
    \midrule
    Working range & \SI{43}{mm}--\SI{53}{mm} \\
    Output range & \SI{10}{V}--\SI{0}{V} \\
    \midrule
    Resolution & $<\SI{10}{\micro m}$ \\
    Response time & \SI{0.5}{ms} \\
    \bottomrule
  \end{tabular}
\end{table}

The measured output of the sensor was used infer a magnet displacement, \DispMag, (referenced from the \qzs\ position) with the following transformation:
\begin{dmath}
  \DispMag\fn{\DisplSensor,\OriginMagHigh} = 
    \OriginMagDisp\fn{\DisplSensor} - \OriginQZS\fn{\OriginMagHigh}
\end{dmath},
where $\OriginQZS$ is the height of the \qzs\ location, given by
\begin{dmath}
  \OriginQZS\fn{\OriginMagHigh} = \half\gp{\HeightRig-\OriginMagLow-\OriginMagHigh-\HeightRigMagnets}
\end{dmath},
and the displacement of the magnets $\OriginMagDisp$ is
\begin{dmath}
  \OriginMagDisp\fn{\DisplSensor} = \OriginBeam + \DisplSensorBeam\fn{\DisplSensor} {\cdot} \LengthRigMagnets/\LengthSensor - \HeightBeam + \ThicknessBeam + \half \HeightRigMagnets
\end{dmath},
where $\DisplSensorBeam$ is the vertical displacement measured at the position
of the sensor, given by
\begin{dmath}
  \DisplSensorBeam\fn{\DisplSensor} = \gp{\HeightRig - \OriginBeam} - \HeightSensor - \DisplSensor
\end{dmath}



\subsection{Translational effects of the rotating beam}
\seclabel{rotating-beam}

Three moving magnets were required in the system: one at the main end of the
motional beam to be repelled for positive stiffness by the fixed lower magnet;
a second to be used with electromagnetic coil for control forces; and the
third to be attracted for negative stiffness by the fixed upper magnet.

The beam added a horizontal constraint to the system for stability. As the
beam rotates, the magnets move predominantly in the vertical direction; there
is still some horizontal motion, however, and the area restricted by the
electromagnetic coil requires attention to ensure that there is no contact
between the moving magnet and the fixed coil. However, the smaller the inner
radius of the coil, the greater the forces imparted by the coil on the magnet
(see \figref[vref]{vary-airgap}), so the smaller the tolerance the better.

A simplified geometry of the moving magnet arrangement is used to calculate
the minimum tolerance required to avoid contact with the coil as a function
of the vertical motion of the magnets. This geometry is shown in 
\figref{horiz-tolerance}, where the L-shaped magnet support is shown
in the `rest' position $\overline{OAB}$ and in a rotated position $\overline{OA'B'}$.

\begin{figure}
  \asyfig{Rig/horiz-tolerance}
  \caption{Geometry for calculating the horizontal tolerance of the inner
           dimensions of the coil.}
  \figlabel{horiz-tolerance}
\end{figure}

The horizontal displacement of the highest point after rotation, $x$, can be
calculated as a function of rotation angle $\theta$
\begin{dgroup}
\begin{dmath}
  x = h \Sin{\theta} + f
\end{dmath},
\begin{dmath}
  f = l - l \Cos{\theta}
\end{dmath},
\end{dgroup}
where $l$ is the horizontal length of the magnet arrangement, and $h$ is the
vertical height. This can be expressed in terms of the vertical displacement
of the main beam, $z$, with $\Sin{\theta}=z/l$ and using the trigonometric
relationship $\Cos{\ArcSin{a}}=\sqrt{1-a^2}$:
\begin{dmath}
  x = h z / l + l - \sqrt{l^2-z^2}
\end{dmath}.

From the dimensions chosen for the rig, $l=\SI{300}{mm}$ and
$h\approx\SI{50}{mm}$, the minimum horizontal tolerance for a vertical
displacement $z=\SI{1}{mm}$ is \SI{0.168}{mm} and for $z=\SI{2}{mm}$ is
\SI{0.34}{mm}. (The relationship between $x$ and $z$ being fairly linear for
most values of $l$ and $h$ with small ranges of $z$.) This tolerance was
judged to be small enough to allow a surrounding coil without having a
significantly diminished force characteristic from the air gap required to
avoid contact.

\section{Experimental results}

A number of measurements were performed using the experimental apparatus;
in the sections following, data recorded is presented for 
\begin{enumerate}
\item Magnet gap versus beam displacement;
\item Open loop frequency responses for a range of magnet gaps; and,
\item Velocity feedback in a single configuration.
\end{enumerate}

\subsection{Displacement calibration}

The upper magnet's position was varied until the limit of stability was
reached. The lower fixed magnet was kept fixed, which means that the position
of \qzs\ was changing; with counter-threaded mounts for the upper and lower magnets, they could be adjusted in parallel to achieve a fixed \qzs\ location. 

As the upper magnet placement was lowered, the rest position of the beam moved
closer to the \qzs\ position (as more force was supported by the upper magnet).
This relationship is shown in \figref{turns-qzs}.
The normalised magnet gap is used in the following sections to
represent the varied configuration of the spring in the experiments.
From the geometry of the rig,
the position of the upper magnet was used to calculate the
gap between the magnets at \qzs:
\begin{dmath}
  \OriginMagGap =
    \half\gp{\HeightRig-\OriginMagLow-\OriginMagHigh-\HeightRigMagnets}
    +\HeightMag+\HeightBuffer
\end{dmath},
where geometrical properties are described in \tabref{rigprop} and 
$\HeightBuffer=\SI{2.5}{mm}$ is a little extra height to account for extra
space taken up by the beam shell thickness and the shell of the magnet mount.
The normalised magnet gap is $\ngap=\OriginMagGap/\HeightMag$, where 
$\HeightMag$ is the height of the magnets.

\begin{figure}
  \psfragfig{\phdpath XPMT/latex/turns-qzs}
  \caption{Rest position of the system as the magnet position varies.}
  \figlabel{turns-qzs}
\end{figure}

\subsection{Open loop measurements}

As the position of the upper magnet is varied, the amount of negative
stiffness added to the system changes. This predominantly affects the rest
position and the resonance frequency, along with with small changes in
damping. Frequency response measurements were taken at a number of discrete
locations of the upper fixed magnet to observe the changes in dynamics as the
rest position of the system approached the \qzs\ position.

Due to the low damping and low resonance frequency of the system, very long
sample times were required to achieve results with enough frequency resolution
and sufficient coherence to characterise the response. The parameters used to
perform the spectral analysis for each measurement are shown in
\tabref{rig-ol-spect}.

\begin{table}
  \begin{tabular}{@{}ll@{}}
    \toprule
      Sample rate        & \SI{1000}{Hz}           \\
      \FFT\ points       & $2^{16}$                \\
      Sample time        & $\approx$\SI{17.5}{min} \\
      Average overlap    & $0.75$                  \\
      Number of non-overlapping averages & $16$    \\ 
    \bottomrule
  \end{tabular}
  \caption{Parameters used in the signal and spectrum analysis for the
   experimental measurements.}
  \tablabel{rig-ol-spect}
\end{table}

\fixme{Do I need to add the part types of the accelerometers and charge amplifiers and filters?}

Open loop measurements were taken both with and without the electromagnetic
actuator connected (wired up as both a short circuit and an open circuit). In
the closed circuit configuration, the coil adds damping via induced eddy
currents from the moving magnet. As an open circuit, the coil has no effect on
the dynamics of the system.

Open loop measurements without the coil connected are shown in
\figref{ol-undamped-frflin}. and measurements taken with the coil (\ie, with
added damping) shown in \figref{ol-damped-frflin}. For both of these results,
the transmissibility, \transmissibility, shown is the transfer function
between the accelerometer measurements of the base and magnet-supported beam:
\note{Calculated with \Matlab's \texttt{tfestimate} command.}
\begin{dmath}[label=Tbm]
  \transmissibility = \frac{\crossSpectMagnetBase}{\powerSpectBase}
\end{dmath}.

\begin{figure}[p]
  \psfragfig{\phdpath XPMT/latex/ol-undamped-frflin}
  \caption{Open loop measurements with the electromagnetic coil connected in
           an open circuit; no additional damping is added to the system.}
  \figlabel{ol-undamped-frflin}
\end{figure}

\begin{figure}[p]
  \psfragfig{\phdpath XPMT/latex/ol-damped-frflin}
  \caption{Open loop measurements, with the electromagnetic coil connected
           in a closed circuit. The coil adds damping to the system, which can
           be seen by the reduction in height of the resonant peaks in 
           comparison to \figref{ol-undamped-frflin}.}
  \figlabel{ol-damped-frflin}
\end{figure}

\subsection{Analysis of the open loop data}

From the measurements shown in the previous section, data fitting of the
frequency response functions was used to extract a linear model of the system
in each configuration.

The model used to fit the data is the simple system of vibration isolation,
\eqref{simple-isolation-freq} in terms of the resonant frequency, $\natfreq =
\sqrt{\stiffness/\mass}$, and damping ratio $\dampingratio = \damping /
(2\sqrt{\stiffness\mass})$. The resulting expression is
\begin{dmath}[label=fit-model]
  \transmissibility\fn{\freq} = \frac
    {2\ii\dampingratio\freq\natfreq + \natfreq^2}
    {-\freq^2 + 2\ii\dampingratio\freq\natfreq + \natfreq^2},
\end{dmath}
where $\freq$ is the frequency at which to calculate the transmissibility
$\transmissibility$. The data is fit \note{Using \Matlab's
\code{fminsearch}.} to \eqref{fit-model} between $\half\natfreq \le \freq
\le 2\natfreq$, returning good estimates of the resonance frequency and
damping ratio of the system corresponding to each measurement taken. Plots of
the curve fit models shown against the measured data are shown in
\figref{ol-undamped-frflin-fit,ol-damped-frflin-fit}. Due to the influence of
higher-order dynamics in the system, the model starts to deviate from the data
at higher frequencies. The resonance frequencies and damping ratios are shown
in \figref{ol-results}.

\begin{figure}[p]
  \psfragfig{\phdpath XPMT/latex/ol-undamped-frflin-fit}
  \caption{Curve fit model of \figref{ol-undamped-frflin}. Grey lines show the original data.}
  \figlabel{ol-undamped-frflin-fit}
\end{figure}

\begin{figure}[p]
  \psfragfig{\phdpath XPMT/latex/ol-damped-frflin-fit}
  \caption{Curve fit model of \figref{ol-damped-frflin}.  Grey lines show the original data.}
  \figlabel{ol-damped-frflin-fit}
\end{figure}

\begin{figure}
  \begin{wide}
  \begin{subfigure}
    \psfragfig{\phdpath XPMT/latex/ol-reson}
    \caption{Model-derived resonant frequencies\figlabel{ol-reson}}
  \end{subfigure}
  \begin{subfigure}
    \psfragfig{\phdpath XPMT/latex/ol-dampi}
    \caption{Model-derived damping ratio\figlabel{ol-dampi}}
  \end{subfigure}
  \end{wide}
  \caption{Analysed results from fitting the open loop measurements to the isolator model of \eqref{fit-model}.}
  \figlabel{ol-results}
\end{figure}

From \figref{ol-reson} it can be seen that the resonant frequency remains
unaffected by the presence of the electromagnetic coil (which can also be
observed by comparing \figref{ol-undamped-frflin,ol-damped-frflin}) but the
damping is increased significantly.


\subsection{Observed nonlinear behaviour}

The dynamics shown in the undamped case are more nonlinear than the damped
case; this is due to the greater displacements experienced by the beam moving
the magnets through greater ranges of stiffness variation. When the
transmissibility is calculated as the transfer function between the input and
output signals, the system is assumed to be linear and nonlinearities are
rejected by the ratio of the cross-spectrum and power-spectrum terms in
\eqref{Tbm}. A different result can be shown by calculating the
transmissibility instead with a ratio of the individual power spectra of the
base and magnet:
\begin{dmath}[label=frfnl]
  \transmissibility\fn{\freq} = \sqrt{\powerSpectMagnet/\powerSpectBase},
\end{dmath}
where $\powerSpectMagnet$ is the power spectra of the accelerometer
measurements at the moving magnet and $\powerSpectMagnet$ is the power spectra
of the accelerometer measurements of the base. In this case, any
nonlinearities in the signals are retained in the final result.

The transmissibility calculated with this method is shown in
\figref{ol-undamped-frfnl}. In this case, the nonlinearities present in the
system are more prominent, and a clear peak is shown at close to twice the
`natural' resonance frequency.

\begin{figure}
  \psfragfig{\phdpath XPMT/latex/ol-undamped-frfnl}
  \caption{Open loop measurements without the coil connected; the transmissibility is calculated with \eqref{frfnl}. Black markers show resonant frequencies and the points at twice each resonant frequency, indicating the higher-order dynamics.}
  \figlabel{ol-undamped-frfnl}
\end{figure}

\subsection{Velocity feedback results}

For this experiment, the rest position of the spring was chosen to some low
resonant frequency (approximately \SI{3.5}{Hz}) and velocity feedback applied
to the system. Sampling parameters are as shown previously in
\tabref{rig-ol-spect}.

In this position, the electromagnetic coil was used in a simple velocity
feedback controller in an attempt to reduce the height of the resonance peak.
The gain of the feedback control was increased until the system became close
to instability. Frequency response measurements over this range of feedback
gains are shown in \figref{cl-results}.

\begin{figure}
  \psfragfig{\phdpath XPMT/latex/cl-results}
  \caption{Closed loop frequency response measurements for a range of velocity feedback gains.}
  \figlabel{cl-results}
\end{figure}

To measure the velocity of the moving beam, the accelerometer measurement is
integrated by the charge amplifier with a cut-on frequency of \SI{1}{Hz}.
Because the accelerometers were now being used to measure velocity, the
transmissibility curves shown below were calculated from the ratio of the
velocity measurements instead.

Due to the presence of higher-order dynamics in the structure, a low pass
filter was used to reject signals above \SI{50}{Hz}. This also ensured that
aliasing was avoided when taking the frequency response measurements and when
feeding back the velocity signal for the controller.

The overall improvement to the vibration isolation can be shown by calculating
the root-mean-square of the transmissibility over a certain frequency range.
\begin{dmath}
  \RMSof\transmissibility = 
  \sqrt{\Sum{\transmissibility\fn{\freq}^2}{\freq,\freq_1,\freq_2}}
\end{dmath}
The results become very noisy in \figref{cl-results} below
$\freq_1=\SI{1}{Hz}$, so this is defined as our lower frequency
limit. The upper frequency limit $\freq_2=\SI{11}{Hz}$ is chosen
as the higher-order dynamics (not shown in \figref{cl-results}) have little
impact yet.

\Figref{cl-reduction} shows the reduction in root-mean-square transmissibility
$\RMSof\transmissibility$ the negative feedback gain increases.
The resonance appearing in the lower frequencies of \figref{cl-results} causes
the overall transmissibility reduction to have a local minimum.

\begin{figure}
  \psfragfig{\phdpath XPMT/latex/cl-reduction}
  \caption{Reduction in overall transmissiblity between \SI{1}{Hz} and \SI{11}{Hz}.}
  \figlabel{cl-reduction}
\end{figure}

\paragraph{On the feedback gain magnitude} \Figref{cl-results,cl-reduction}
plot results in terms of a `feedback gain' given in dimensionless units. This
gain is the multiplier from the controller on the velocity signal that also
incorporates the effects of the amplifiers for both sensors and actuators;
therefore, the absolute magnitude of this number is unimportant and is used
purely to demonstrate the range of behaviours seen as the gain is increased
until instability appears.

\subsubsection{Analysis on the gain-induced resonance}

The appearance of a low frequency peak in \figref{cl-results} as the feedback
gain is increased is explained by the presence of the high-pass filter
incorporated in the accelerometer charge amplifier. This behaviour is shown by
\textcite{ananthaganeshan2001,brennan2007} for single degree of freedom
structures with velocity feedback. Here, the same type of analysis will be
used to investigate the response of a linear two degree of freedom isolator
system (shown in \figref{vibration-base-feedback}) with integrated
accelerometer measurements used for velocity feedback control.

\begin{figure}
  \asyfig{Systems/vibration-base-feedback}
  \caption{Vibration isolation schematic with active feedback.}
  \figlabel{vibration-base-feedback}
\end{figure}

In the time domain, the response of this linear system is given by
\begin{dmath}
\massMass \accelMass = 
  \forceIn - \damping\gp{\velMass-\velBase} - \stiffness\gp{\dispMass-\dispBase}
\end{dmath},
which can be re-written in the Laplace domain as
\begin{dmath}[label=simple-isolator-laplace]
s^2 \laplaceMass \underbrace{\gp{\massMass+\damping/s+\stiffness/s^2}}_{\gp{\Block[2]}^{-1}} = 
  \laplaceForce + s^2 \laplaceBase \underbrace{\gp{\damping/s+\stiffness/s^2}}_{\Block[1]}
\end{dmath}.
This is shown as a block diagram in \figref{simple-isolator-block}. If the
control force is written as a function of the acceleration of the mass,
$\laplaceForce=s^2\laplaceMass\BlockController$, the transmissibility of the system is
\begin{dmath}[label=cl-generic]
  \frac\laplaceMass\laplaceBase = \frac{\Block[1]\Block[2]}{1+\BlockController\Block[2]}
\end{dmath}.

\begin{figure}
  \asyfig{Control/simple-isolator-block}
  \caption{Block diagram of \eqref{simple-isolator-laplace} representing
  the system shown in \figref{vibration-base-feedback}.}
  \figlabel{simple-isolator-block}
\end{figure}

When the controller is some gain $\gain$ in series with an ideal integration
of the accelerometer signal, $\BlockController = \gain/s$, \eqref{cl-generic}
simplifies to the skyhook damping expression shown in \secref{skyhook}. This
result is plotted in \figref{cl-ideal} for equivalent values of stiffness and
damping as the experimental setup.

A more complex model for the controller block is required to account for the
signal processing involved with amplifying and filtering the accelerometer
signal to measure the velocity in reality. Assuming that the entire process
between acceleration measurement and velocity output from the charge amplifier
can be approximated as an ideal integrator in series with two high pass
filters\footnote{One filter for the integration of the acceleration signal,
another for the conditioning electronics in the amplifier; assume for
simplicity that they have the same cut-on frequency.} \parencite{brennan2007},
the controller block is defined as
\begin{dmath}[label=cl-filter-controller]
  \BlockController = \frac \gain s \gp{\frac{s}{s+\freqHPfilter}}^2
\end{dmath},
where $\gain$ is the feedback gain and $\freqHPfilter$ is the corner frequency
of the high pass filter in the charge amplifier.

Using \eqref{cl-filter-controller} in \eqref{cl-generic} gives
the final transfer function between the mass and base states,
\begin{dmath}[label=cl-filter]
  \frac\laplaceMass\laplaceBase = 
    \frac{ \gp{\damping s+\stiffness} \gp{s+\freqHPfilter}^2 }
         { 
           \gain s^3 +
           \gp{ \massMass s^2 + \damping s + \stiffness }
           \gp{ s+\freqHPfilter }^2
         }
\end{dmath}.
This is plotted versus frequency in \figref{cl-filter}, where the resonance
induced by the high pass filter becomes apparent as the feedback gain is
increased to 99\% of the maximum gain (which is the gain when the system
becomes unstable). The simulation uses linear parameters $\freq=\SI{3.5}{Hz}$
and $\dampingratio=\num{0.023}$ in order to show results at similar behaviour to \figref{cl-results}.

In order to calculate the maximum gain of \eqref{cl-filter},
$\BlockController\Block[2]$ was evaluated equal to $-1$, where the system
response of \eqref{cl-generic} becomes unbounded. To do this, first the
critical frequency was found as the frequency at which
$\Imag{\BlockController\Block[2]}=0$; this frequency was then substituted into
$\Real{\BlockController\Block[2]}=-1$, which was solved for $\gain$ to find
the maximum gain.

\begin{figure}
  \begin{wide}
  \begin{subfigure}
    \psfragfig{\phdpath Simulations/Springs/fig/cl-ideal}
    \caption{Ideal velocity signal.\figlabel{cl-ideal}}
  \end{subfigure}
  \begin{subfigure}
    \psfragfig{\phdpath Simulations/Springs/fig/cl-filter}
    \caption{Integrated accelerometer feedback with a double high pass filter.\figlabel{cl-filter}}
  \end{subfigure}
  \end{wide}
  \caption{Closed loop simulation with gains $\{0, 5, 10, 20, 50, 99\}$ percent of the maximum gain before instability in \figref{cl-filter}.}
\end{figure}

Comparing \figref{cl-filter} with \figref{cl-results} shows a clear
similarity. The corner frequency of the high pass filter at \SI{1}{Hz} in the
charge amplifier to measure velocity is an impediment to the vibration
isolation properties of the feedback-controlled system. This potential
drawback could be mitigated with a different way to estimate the velocity of
the isolated beam; simply a higher-precision charge amplifier would probably
be acceptable.


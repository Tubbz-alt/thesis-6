%!TEX root = thesis.tex
\ProvidesPackage{thesis-maths}

%%%%%%%%%%%%%%%%%
%% For COOL
\let\orig@Integrate\Integrate
\renewcommand\Integrate[2]{%
  \@ifnextchar\bgroup
    {\Integrate{\orig@Integrate{#1}{#2}}}
    {\orig@Integrate{#1}{#2}}}
\let\Int\Integrate

%\renewcommand\D[3][]{%
%  \mathrm{\textsc{d}}_{#3^{#1}}\,#2}
%%%%%%%%%%%%%%%%%
\Style{LogParen=p,ArcTrig=arc,ImagParen=p,RealParen=p}
%%%%%%%%%%%%%%%%%


%%% put this somewhere %%%

\renewcommand\t[1]{\theta_#1}
\def\nl{\mathrm{~\color[gray]{0.7}\small\dots}\\}

\newcounter{wspr}
\newcommand\p[1]{%
  \setcounter{wspr}{1}
  \varphi_#1(x_1\whiledo{\value{wspr}<#1}{%
    \stepcounter{wspr}%
    ,x_\thewspr})}


%%%%%%

\let\vect\mathbf

\NewDocumentCommand\sumset{mm}{\sum_{#1}^{#2}}

\newcommand\inlinefrac[2]{#1/#2}

\newcommand\funcparen[2]{#1\mathopen{}\left(#2\right)}

\renewmlist\func[
  headcmd=\mlisthead,
  elemcmd=\mlistelem,
  wrapcmd=\funcparen,
  wraponecmd]

\newcommand\inlinevect[2][]{%
  \def\insertvectsep{\def\insertvectsep{\,,~}}
  \left[
    \@for\@ii:=#2\do{\insertvectsep\@ii}
  \right]
}

\newcommand\inlinematr[1]{%
  \matr{}{#1}%
}

\mlistsetup{headcmd=\vect}

\newcommand\boldsubs[2]{\vect{#2}_{#1}}
\newcommand\elemboldhat[2]{\hat{\vect{#2}}}
\newcommand\elemboldhatprime[2]{\hat{\vect{#2}}'}
\newcommand\headcal[2]{\mathcal{#1}}
\newcommand\onlyhead[2]{#1}
\newcommand\onlyelem[2]{#2}

% Greek transliteration
% <obelix.ee.duth.gr/~apostolo/mkgrkindex/mkgrkindex.pdf>

\ExplSyntaxOn

\cs_new:Nn \wspr_greek_trans:N
 {
                  \tl_set_eq:NN \l_tmpa_tl #1
                  \tl_replace_all:Nnn \l_tmpa_tl {\bm} {}
                  \tl_replace_all:Nnn \l_tmpa_tl {\dot} {}
                  \tl_replace_all:Nnn \l_tmpa_tl {\ddot} {}
                  \tl_replace_all:Nnn \l_tmpa_tl {\vect} {}
                  \tl_replace_all:Nnn \l_tmpa_tl {\hat} {}
                  \tl_replace_all:Nnn \l_tmpa_tl {\alpha} {zzzgreek-a}
                  \tl_replace_all:Nnn \l_tmpa_tl {\beta} {zzzgreek-b}
                  \tl_replace_all:Nnn \l_tmpa_tl {\delta} {zzzgreek-d}
                  \tl_replace_all:Nnn \l_tmpa_tl {\epsilon} {zzzgreek-e}
                  \tl_replace_all:Nnn \l_tmpa_tl {\varepsilon} {zzzgreek-ee}
                  \tl_replace_all:Nnn \l_tmpa_tl {\iota} {zzzgreek-i}
                  \tl_replace_all:Nnn \l_tmpa_tl {\omicron} {zzzgreek-o}
                  \tl_replace_all:Nnn \l_tmpa_tl {\pi} {zzzgreek-p}
                  \tl_replace_all:Nnn \l_tmpa_tl {\gamma} {zzzgreek-c}
                  \tl_replace_all:Nnn \l_tmpa_tl {\zeta} {zzzgreek-f}
                  \tl_replace_all:Nnn \l_tmpa_tl {\eta} {zzzgreek-g}
                  \tl_replace_all:Nnn \l_tmpa_tl {\theta} {zzzgreek-h}
                  \tl_replace_all:Nnn \l_tmpa_tl {\vartheta} {zzzgreek-hh}
                  \tl_replace_all:Nnn \l_tmpa_tl {\kappa} {zzzgreek-j}
                  \tl_replace_all:Nnn \l_tmpa_tl {\lambda} {zzzgreek-k}
                  \tl_replace_all:Nnn \l_tmpa_tl {\mu} {zzzgreek-l}
                  \tl_replace_all:Nnn \l_tmpa_tl {\nu} {zzzgreek-m}
                  \tl_replace_all:Nnn \l_tmpa_tl {\xi} {zzzgreek-n}
                  \tl_replace_all:Nnn \l_tmpa_tl {\rho} {zzzgreek-q}
                  \tl_replace_all:Nnn \l_tmpa_tl {\sigma} {zzzgreek-r}
                  \tl_replace_all:Nnn \l_tmpa_tl {\varsigma} {zzzgreek-rr}
                  \tl_replace_all:Nnn \l_tmpa_tl {\tau} {zzzgreek-s}
                  \tl_replace_all:Nnn \l_tmpa_tl {\upsilon} {zzzgreek-t}
                  \tl_replace_all:Nnn \l_tmpa_tl {\phi} {zzzgreek-u}
                  \tl_replace_all:Nnn \l_tmpa_tl {\Phi} {zzzgreek-U}
                  \tl_replace_all:Nnn \l_tmpa_tl {\varphi} {zzzgreek-uu}
                  \tl_replace_all:Nnn \l_tmpa_tl {\chi} {zzzgreek-v}
                  \tl_replace_all:Nnn \l_tmpa_tl {\psi} {zzzgreek-w}
                  \tl_replace_all:Nnn \l_tmpa_tl {\omega} {zzzgreek-x}
                  \tl_set:Nf \l_tmpa_tl { \l_tmpa_tl }  
                  \tl_set:Nx #1 { \tl_to_str:N \l_tmpa_tl }  
 }

\DeclareDocumentCommand \newvariable { m O{} m }
 {
  \tl_clear:N \nomennom \tl_clear:N \nomenlabel \tl_clear:N \nomensort
  \setkeys{thesisnomen}{#2}

  \ifx \nomenlabel \empty \edef \nomenlabel { \detokenize{#3} } \fi
  \ifx \empty \nomensort \tl_set:Nn \nomensort {#3} \fi
  \wspr_greek_trans:N \nomensort
  
  \tl_if_empty:NT \nomennom \ERROR
  \use:x
   {
    \noexpand\newglossaryentry
      {\nomenlabel}
      {
%       parent = \nomenparent,
       name = \unexpanded{\ensuremath{#3}},
       sort = \nomensort,
       description = {\unexpanded\expandafter{\nomennom}},
      }%
    \protected\def\noexpand #1{{\noexpand\color{red}\noexpand\gls{\nomenlabel}}}%
%    \protected\def\noexpand #1{\noexpand\gls{\nomenlabel}}%
%    \protected\def\noexpand #1{}%
   }
 }

\DeclareDocumentCommand \newmvar { m m m O{} m }
% E.G.: \newmvar\newfunc\magforce{F_m}[elem={\mdim,\ndisp},index={1,2}]{nom={Magnet force vector}}
 {
  \tl_clear:N \nomennom \tl_clear:N \nomenlabel \tl_clear:N \nomensort
  \setkeys{thesisnomen}{#5}

  \ifx \nomenlabel \empty \edef \nomenlabel { \detokenize{#3} } \fi
  \ifx \empty \nomensort \tl_set:Nn \nomensort {#3} \fi
  \wspr_greek_trans:N \nomensort
  
  \tl_if_empty:NT \nomennom \ERROR
  \use:x
   {
    \noexpand\newglossaryentry
      {\nomenlabel}
      {
%       parent = \nomenparent,
       name = \unexpanded{\ensuremath{#3}},
       sort = \nomensort,
       description = {\unexpanded\expandafter{\nomennom}},
      }%
    \exp_not:N #1 \exp_not:N #2 { {\noexpand\color{red}\exp_not:N \gls{\nomenlabel} } } [ \exp_not:n {#4} ]
%    \exp_not:N #1 \exp_not:N #2 { {\exp_not:N \gls{\nomenlabel} } } [ \exp_not:n {#4} ]
%    \exp_not:N #1 \exp_not:N #2 {  } [ \exp_not:n {#4} ]
   }
 }
\errorcontextlines=999
\ExplSyntaxOff

\define@key{thesisnomen}{nom}{\gdef\nomennom{#1}}
\define@key{thesisnomen}{sort}{\gdef\nomensort{#1}}
\define@key{thesisnomen}{label}{\gdef\nomenlabel{#1}}
\let\nomenparent\empty

%%%%%%%%%%%%%%%%%%%%%%%
\newcommand\RMSof[1]{#1_{\textsc{rms}}}

%%%%%%%%%%%%%%%%%%%%%%%
%% MAGNETS

\newvariable\incr[nom={Displacement increment}]{\delta}

\newvect\cuboida{V_a}[
  elemcmd=\mlistelem,
  elem={a,b,c}
]
\newvect\cuboidb{V_b}[
  elemcmd=\mlistelem,
  elem={A,B,C}
]
\newvect\cuboidoffset{\Delta}[
  elemcmd=\mlistelem,
  elem={\alpha,\beta,\gamma}
]

\newvariable\ratioCub[nom=Square-face cuboid magnet aspect ratio,label=cuboidaspect]{\gamma}
\newvariable\ratioCoil[nom=Coil aspect ratio]{\beta}
\newvariable\ratioMag[nom=Cylindrical magnet aspect ratio,label=cylaspect]{\alpha}
\newvariable\ratioLengthArea[nom={Ratio of magnet length squared to face area}]{\nu}

\newvariable\lengthCub[nom=Cuboid magnet depth,label=cubdept]{a}
\newvariable\faceCub[nom=Cuboid magnet face side length,label=cubside]{b}
\newvariable\lengthCube[nom=Cube magnet side length,label=cubelength]{c}
\newvariable\magnetGap[nom=Gap between magnets in various magnetic spring designs]{G}
\let\choiGap\magnetGap

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Axes directions:
\newvariable\ax[nom={Cartesian unit vector}]{\hat x}
\newvariable\ay[nom={Cartesian unit vector}]{\hat y}
\newvariable\az[nom={Cartesian unit vector}]{\hat z}

\newvariable\volume[nom=Volume]{V}
\newvariable\area[nom=Area]{A}
\newvariable\surface[nom=Surface]{S}
\newvariable\diffsurface[nom=Differential surface]{s}
\newvariable\diffvolume[nom=Differential volume,label=diffvolume]{v}
\newvariable\vecarea[nom=Vector area (direction normal to plane)]{\vect A}

\let\olddot\dot
\let\oldddot\ddot
\def\dot{\expandafter\olddot}
\def\ddot{\expandafter\oldddot}

\newvariable\e[nom={Euler's number, the natural logarithm base, $\approx 2.71828$}]{e}

\newvariable\varianceNoise[nom=White noise variance]{S_w}
\newvariable\forceDuffing[nom=Duffing spring force]{F_{\text{Duffing}}}
\newvariable\normn[nom=Surface normal vector,sort=n]{\hat{\vect{n}}}
\newvariable\forceMag[label=FFF,nom=Magnitude of force]{F}
\newvariable\forceMagnet[label=Fm,nom=Magnetic force]{F_m}
\newvariable\stiffnessMag[label=KKK,nom={Magnitude of stiffness characteristic (derivative of force with respect to displacement)}]{K}
\newvariable\normforceMag[nom=Normalised force magnitude,sort=Fbar]{\bar \forceMag}
\newmvar\newvect\force{F}[elem={x,y,z}]{nom=Force vector}
\newmvar\newvect\torque{T}{nom=Torque vector}
\newmvar\newvect\lever{r}{nom=Lever arm vector}

\newvariable\forceGrav[label=forceGrav,nom=Gravity force]{F_g}
\newvariable\gravity[label=grav,nom=Acceleration due to gravity]{g}
\newvariable\disp[label=disp,nom=Displacement]{x}
\let\displ\disp
\newvariable\disturb[nom=Disturbance,label=disturbance]{s}

\newcommand\equil{\text{eq}}

\newmvar\newvect\displacement{x}{nom=Displacement vector}
%\newvariable\pos[nom=Displacement vector]{\vect{x}}
\let\pos\displacement

\newmvar\newvect\velocity{v}{nom=Velocity vector}
\newvariable\natfreq[nom={Natural frequency, $\sqrt{\stiffness/\mass}$}]{\omega_n}
\newvariable\resfreq[nom={Resonance frequency, $\natfreq\sqrt{1-\dampingratio^2}$}]{\omega_d}
\newcommand\approaches{\rightarrow}

\newvariable\flux[nom=Magnetic flux]{\bm\Phi}
\newvariable\magH[nom=Magnetic field strength]{\vect H}
\newvariable\magB[nom=Magnetic flux density]{\vect B}
\newvariable\remanence[nom=Remanence magnetisation]{B_r}
\newvariable\maggradesym[nom={Magnet grade, units \si{MG.Oe}},label=maggradesym]{N}
\newcommand\magn[1]{{\remanence}_{#1}}
\newvariable\coerce[nom=Coercivity]{H_c}
\newvariable\Msat[nom=Magnetisation at saturation]{M_{\mathrm{sat}}}
%\newvect\magflux{B}
\let\magflux\magB
\newmvar\newvect\magM{M}{nom=Magnetisation vector}
\newmvar\newvect\magN{\hat M}{nom=Unit magnetisation vector}
\newmvar\newvect\magJ{J}{nom=Current density vector}
\newvariable\magJm[nom=Equivalent `surface current' due to magnetisation]{\vect{J}_m}
\newvariable\magjm[nom=Differential `Surface current' due to magnetisation]{\vect{j}_m}

\newvariable\permVac[nom=Permeability of the vacuum]{\mu_0}
\let\permvac\permVac

\newvariable{\perm}[nom=Permeability of a material]{\mu}
%\newcommand{\permMag}{\mu}
\let\permMag\perm
\newvariable{\permrel}[nom=Relative permeability of a material]{\mu_r}
\newcommand\magconst{\frac{\permVac}{4\pi}}

%%%%%%%%%%%%%%%%%%%%%%%%
%% MAGNETS
%%%%%%%%%%%%%%%%%%%%%%%%

\newvariable\cdx[nom={$\ax$-component of $\magcd$},label=cdx]{\alpha}
\newvariable\cdy[nom={$\ay$-component of $\magcd$},label=cdy]{\beta}
\newvariable\cdz[nom={$\az$-component of $\magcd$},label=cdz]{\gamma}
\newvariable\magcd[nom={Distance vector between the centres of two magnets, $\magcd=\inlinevect{\cdx,\cdy,\cdz}\T$}]{\vect d}

\newvariable\cnrx[nom={$\ax$-component of $\cornerd$},label=cnrx]{u}
\newvariable\cnry[nom={$\ay$-component of $\cornerd$},label=cnry]{v}
\newvariable\cnrz[nom={$\az$-component of $\cornerd$},label=cnrz]{w}
\newvariable\cornerd[nom={Distance vector between a pair of corners/nodes of two magnets, $\cornerd=\inlinevect{\cnrx,\cnry,\cnrz}\T$}]{\bm\delta}
\newvariable\cnrl[nom={Euclidean distance of $\cornerd$},label=cnrl]{r}

\newvariable\cdcnrX[nom={Distance vector between a magnet's centre and one of its corners/nodes (fixed magnet)}]{\vect r}
\newvariable\cdcnrF[nom={Distance vector between a magnet's centre and one of its corners/nodes (floating magnet)}]{\vect R}

\newvariable\Fzz[nom={Force between two cuboid magnets magnetised in the $\az$-direction},sort=Fzz]{\vect F_{z,z}}
\newvariable\Fzznode[nom={`Force' between two magnetic nodes for cuboid magnets magnetised in the $\az$-direction, used to calculate $\Fzz$},sort=zzzgreek-uzz]{\bm\phi_{z,z}}

\newvariable\Fzy[nom={Force between two cuboid magnets; the first magnetised in the $\az$-direction, the second in $\ay$},sort=Fzy]{\vect F_{z,y}}
\newvariable\Fzynode[nom={`Force' between two magnetic nodes for orthogonally-magnetised cuboid magnets, used to calculate $\Fzy$},sort=zzzgreek-uzy]{\bm\phi_{z,y}}

\newvariable\Fzx[nom={Force between two cuboid magnets; the first magnetised in the $\az$ direction, the second in $\ax$},sort=Fzy]{\vect F_{z,x}}

\newvariable\Kzz[nom={Stiffness between two cuboid magnets magnetised in the $\az$-direction},sort=Kzz]{\vect K_{z,z}}
\newvariable\Kzznode[nom={`Stiffness' between two magnetic nodes for cuboid magnets magnetised in the $\az$ direction, used to calculate $\Kzz$},sort=kzz]{\vect k_{z,z}}
\newvariable\Tzz[nom={Torque between two cuboid magnets magnetised in the $\az$-direction},sort=Tzz]{\vect T_{z,z}}
\newvariable\Txx[nom={Torque between two cuboid magnets magnetised in the $\ax$-direction},sort=Tzz]{\vect T_{x,x}}
\newvariable\Tzznode[nom={`Torque' between two magnetic nodes for cuboid magnets magnetised in the $\az$ direction, used to calculate $\Kzz$},sort=zzzgreek-w]{\bm\psi}
\newvariable\Tzy[nom={Torque between two cuboid magnets; the first magnetised in the $\az$-direction, the second in $\ay$},sort=Tzy]{\vect T_{z,y}}

\newvariable\hwxX[nom={Half-length of cuboid magnet (fixed), $\ax$ direction}]{a}
\newvariable\hwyX[nom={Half-length of cuboid magnet (fixed), $\ay$ direction}]{b}
\newvariable\hwzX[nom={Half-length of cuboid magnet (fixed), $\az$ direction},label=hwzX]{c}
\newvariable\mwX[nom={Vector of magnet side lengths (fixed)}]{\vect s}

\newvariable\hwxF[nom={Half-length of cuboid magnet (floating), $\ax$ direction},label=hwxF]{A}
\newvariable\hwyF[nom={Half-length of cuboid magnet (floating), $\ay$ direction},label=hwyF]{B}
\newvariable\hwzF[nom={Half-length of cuboid magnet (floating), $\az$ direction},label=hwzF]{C}
\newvariable\mwF[nom={Vector of magnet side lengths (floating)}]{\vect S}

\newvariable\rotX[nom={Planar rotation matrix around the $\ax$ axis}]{\mathbf R_x}
\newvariable\rotY[nom={Planar rotation matrix around the $\ay$ axis}]{\mathbf R_y}
\newvariable\rotZ[nom={Planar rotation matrix around the $\az$ axis}]{\mathbf R_z}

\newvariable\mrot[nom={Magnet rotation},label=magrot]{\theta}

%%%%%%%%%%%%%%%%%%%%%%%%

\newvariable{\mdip}[nom=Magnetic dipole]{\vect m}
\newvariable{\BHmax}[nom=Maximum energy product,sort=BHmax]{\ensuremath{\gp{BH}_{\mathrm{max}}}}
\newmacro \bhcurve {$\magB$/$\magH$ curve}
\newmacro \Hinf {\ensuremath{H^\infty}}

%%%%%%%%%%%%%%%%
%% Eddy currents

\newvariable\magJeddy[nom=Eddy current density]{\vect J_{\mathrm{eddy}}}
\newvariable\forceEddy[nom=Eddy current force]{\vect F_{\mathrm{eddy}}}
\newvariable\conductivity[nom=Conductivity]{\sigma}

\newcommand\half{\textstyle\frac12}
\newcommand\quarter{\textstyle\frac14}

\newcommand{\dee}[1]{\mathrm{d}#1}
\newcommand{\intd}[3][]{\int#1#2\,\dee{#3}}
\newcommand{\od}[2]{\frac{\dee{#1}}{\dee{#2}}}
\newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}}

\let\crossprod\times
\let\cross\times
\let\dotprod\cdot
\DeclareRobustCommand\invtimes{\,}

\let\grad\Grad
\let\curl\Curl
\newcommand{\divgrad}{\nabla^2}
\newcommand{\divgradxyz}[1]{\od{^2#1}{x^2} +\od{^2#1}{y^2} +\od{^2#1}{z^2}}

\def\T{^{\mathrm{T}}}

\newcommand\bdot{\bm{\cdot}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Vibrations

\newglossaryentry{vibrations}{name={Vibrations}, description={\nopostdesc}}
\def\nomenparent{vibrations}

\newvariable\stiffness[nom=Stiffness coefficient]{k}
\newvariable\klin[nom=Linearised stiffness at a certain point]{k_{\mathrm{lin}}}

%\newvariable\stiffnessLinear[label=stiffness-coeff,nom={Coefficient of linear stiffness}]{k}
\let\stiffnessLinear\stiffness
\newvariable\stiffnessQuad[nom=Coefficient of quadratic stiffness]{k_2}
\newvariable\stiffnessDuffing[nom=Coefficient of cubic (Duffing) stiffness]{k_3}

\newvariable\ii[nom=The imaginary number $\sqrt{-1}$]{i}
\newvariable\freq[nom=Frequency]{\omega}

\def\maybedot{}
\newvariable\dispBase[nom=Base displacement]{\maybedot x_1}
\newvariable\laplaceBase[nom={Base response, Laplace domain}]{X_1}
\newcommand\velBase{{\let\maybedot\dot \dispBase}}
\newcommand\accBase{{\let\maybedot\ddot \dispBase}}

\newvariable\dispMass[nom=Displacement of the vibration mass]{\maybedot x_2}
\newvariable\laplaceMass[nom={Vibration mass response, Laplace domain}]{X_2}
\newcommand\velMass{{\let\maybedot\dot \dispMass}}
\newcommand\accMass{{\let\maybedot\ddot \dispMass}}

\newvariable\s[nom=Laplace variable,label=laplace-s]{s}

\newvariable\massAbsorb[nom=Vibration neutraliser mass]{m_a}
\newvariable\dispAbsorb[nom=Vibration neutraliser displacement]{x_a}
\newvariable\respAbsorb[nom={Vibration neutraliser response, Laplace domain}]{X_a}
\newvariable\dampingAbsorb[nom=Damping coefficient of the vibration neutraliser]{c_a}
\newvariable\stiffnessAbsorb[nom=Stiffness of the vibration neutraliser]{k_a}
\newvariable\forceAbsorb[nom=Active force input for an inertial mass or vibration neutraliser]{f_a}

% todo
\newcommand\Block[1][999]{%
  \ifcase #1 G_0\or G_1\or G_2\or G_3\or G_4\else G\fi
}
\newvariable\BlockController[nom=Controller gain]{K}
\newvariable\freqHPfilter[nom=High pass filter cut-on frequency]{\omega_c}

\newvariable\dampingRel[nom=Relative velocity damping coefficient]{c}
\newvariable\dampingAbs[nom=Absolute velocity (skyhook) damping coefficient]{c_{\mathrm{sky}}}
\let\stiffnessRel\stiffnessLinear
\newvariable\forceIn[nom=Force input]{f}
\newvariable\laplaceForce[nom={Force input response, Laplace domain},label=laplaceF]{F}
\newvariable\forceDisturb[label=gg,nom=Force disturbance]{g}
\newvariable\laplaceForceDisturb[label=laplaceG,nom={Force disturbance response, Laplace domain}]{G}

\newmvar\newfunc\transmissibility{T}[elem=\ii\freq,index=1]{nom=Transmissibility,label=transmissibility}

\newcommand\gainArbitrary{g_{(\cdot)}}
\newvariable\gainDisp[nom=Feedback gain on relative displacement]{g_d}
\newvariable\gainVel[nom=Feedback gain on relative velocity]{g_v}
\newvariable\gainAcc[nom=Feedback gain on relative acceleration]{g_a}
\newvariable\gainSkymass[nom=Feedback gain on absolute displacement]{g_m}
\newvariable\gainSkyhook[nom=Feedback gain on absolute velocity]{g_c}
\newvariable\gainSkyspring[nom=Feedback gain on absolute acceleration]{g_k}

\newvariable\dampingratio[nom={Damping ratio, $0.5\dampingRel/\sqrt{\stiffness\mass}$.}]{\zeta}

\newvariable\powerSpectMagnet
  [nom=Power spectrum accelerometer measurements of the moving magnet]
  {P_{mm}}
\newvariable\powerSpectBase
  [nom=Power spectrum accelerometer measurements of the base disturbance]
  {P_{bb}}
\newvariable\crossSpectMagnetBase
  [nom=Cross spectrum accelerometer measurements between the moving magnet and base disturbance]
  {P_{mb}}

\newvariable\potentialEnergy[nom=Potential energy,label=potential]{U}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% COIL

\newglossaryentry{coil}{name={Coil}, description={\nopostdesc}}
\def\nomenparent{coil}

\newcommand\SuffixCoil{c}
\newvariable\surfCoil[nom={Integration surface of the coil}]{S_\SuffixCoil}
\newvariable\volCoil[nom={Integration volume of the coil}]{V_\SuffixCoil}
\newvariable\diffsurfCoil[nom={Region of the integration surface of the coil}]{s_\SuffixCoil}
\newvariable\diffvolCoil[nom={Region of the integration volume of the coil}]{v_\SuffixCoil}

\newcommand\SuffixMagnet{m}
\newvariable\surfMag[nom={Integration surface of the magnet}]{S_\SuffixMagnet}
\newvariable\volMag[nom={Integration volume of the magnet}]{V_\SuffixMagnet}
\newvariable\diffsurfMag[nom={Region of the integration surface of the magnet}]{s_\SuffixMagnet}
\newvariable\diffvolMag[nom={Region of the integration volume of the magnet}]{v_\SuffixMagnet}

\newmvar\newvect\distrMag{d}[headcmd=\boldsubs{1},elemcmd=\mlistelem,elem={\distr_1,\dista_1,\distz_1}]{nom={Position vector for magnet volume $\distrMag=\inlinevect{\distrMag{1},\distrMag{2},\distrMag{3}}^T$},label=d1}
\newmvar\newvect\distrCoil{d}[headcmd=\boldsubs{2},elemcmd=\mlistelem,elem={\distr_2,\dista_2,\distz_2}]{nom={Position vector for differential coil volume in cylindrical coordinates, $\inlinevect{\distrCoil{1},\distrCoil{2},\distrCoil{3}}^T$},label=d2}

\newvariable\distr[nom={Radial component of distance vector in cylindrical coordinates},label=distr]{r}
\newvariable\dista[nom={Angular component of distance vector in cylindrical coordinates}]{\phi}
\newvariable\distz[nom={Axial component of distance vector in cylindrical coordinates}]{z}

\newvect\distcMag{d}[headcmd=\boldsubs{1},elemcmd=\mlistelem,elem={x_1,y_1,z_1}]
\newvect\distcCoil{d}[headcmd=\boldsubs{2},elemcmd=\mlistelem,elem={x_2,y_2,z_2}]

\newvariable\iradiusCoil[nom=Coil inner radius]{r_c}
\newvariable\oradiusCoil[nom=Coil outer radius]{R_c}
\newvariable\iradiusMag[nom=Magnet inner radius]{r_m}
\newvariable\oradiusMag[nom=Magnet outer radius]{R_m}
\def\radiusMag{\oradiusMag}
\newvariable\cradiusCoil[nom=Clearance between magnet and coil radii]{r_g}

\newvariable\lengthCoil[nom=Coil length]{L_c}
\newvariable\lengthMag[nom=Magnet length]{L_m}
\newvariable\offsetCoilMag[nom=Distance between the axial centres of the coil and magnet]{d_z}

\newvariable\lengthWire[nom=Length of the wire in the coil]{l_w}
\newvariable\resistanceCoil[nom=Coil resistance]{R}
\newvariable\areaWire[nom=Cross-sectional area of the wire in the coil]{a_w}
\newvariable\resistivity[nom=Resistivity]{\rho}

\newvariable\turnsCoil[nom=Number of turns in the coil]{N}
\newvariable\turnsRCoil[nom=Number of turns in the radial direction]{N_r}
\newvariable\turnsZCoil[nom=Number of turns in the axial direction]{N_z}
\newvariable\turnsZMag[nom=Magnet `turns']{N_m}

\newvariable\radiusWire[nom=Radius of the wire]{r_w}
\newvariable\diamWire[nom=Diameter of the wire]{d_w}

\newvariable\current[nom=Current]{I}
\let\currentCoil\current

\newvariable\COILnmag[nom=Number of smaller permanent magnets]{n}

\newvariable\coilDualGap[label=G-coil,nom=Gap (axial) between adjacent coils]{G}

\newvariable\forceFilament[nom={Axial force between two circular current loops}]{F_f}
\newvariable\forceThickCoil[nom={Axial force between a thick coil and a magnet}]{F_c}
\newvariable\radius[nom=Radius,label=radius]{r}

\newvariable\Fax[nom={Axial force between two cylindrical thin coils/magnets},label=Fax]{F_z}
\newvariable\Fecc[nom={Radial force between two cylindrical thin coils/magnets}]{F_r}
\let\Fr\Fecc
\let\forceShell\Fax

\def\fpeak{\forceMag_{\mathrm{peak}}}
\def\fmax{\forceMag_{\mathrm{max}}}
\newvariable\fnorm[nom={Thick-coil/magnet force evaluated with a current of \SI{1}{A}}]{\hat \forceThickCoil}
\newvariable\fnpeak[nom={Peak coil/magnet force over displacement}]{\hat \forceMag_{\mathrm{peak}}}
\newvariable\fnmax[nom={Optimised coil/magnet peak force}]{\hat \forceMag_{\mathrm{max}}}
\newvariable\currmax[nom={Maximum current for a given (copper) wire diameter}]{\currentCoil_{\mathrm{max}}\fn{\diamWire}}

\newvariable\safetyFactor[nom={Factor of safety},label=safetyFactor]{S}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%   QZS   %%%%%%%%%%%%%%%%%%%%%%%%%

\newglossaryentry{qzs}{name={\QZS/}, description={\nopostdesc}}
\def\nomenparent{qzs}

\def\polyc#1{c_#1\fn{\ngap}}
\def\polyq#1{q_#1\fn{\ngap}}

% parameters
\newvariable\mdim[nom=Cube magnet side length,label=qzsa]{a}
\newvariable\ngap[nom=Normalised magnet gap,label=qzs-ngap]{d}
\newvariable\ndisp[nom=Normalised nominal magnet displacement,label=qzsl]{l}
\newvariable\ndispZ[nom=Normalised nominal magnet displacement,label=qzsh]{h}
\newvariable\dmax[nom=Maximum displacement bound,label=qzsdelta]{\delta}
\newvariable\mass[nom=Mass]{m}
\let\massMass\mass %% rm
\let\freqdesign\resfreq
\newvariable\damping[nom=Damping coefficient,label=qzs-damping]{c}

\newvariable\ccA[nom=Coefficient for empirical magnet force equation,label=coeffA]{A}
\newvariable\ccB[nom=Coefficient for empirical magnet force equation,label=coeffB]{B}
\newvariable\ccC[nom=Coefficient for empirical magnet force equation]{C}
\newvariable\ccD[nom=Coefficient for empirical magnet force equation]{D}
\newvariable\nn[nom=Exponential for empirical magnet force equation,label=qzs-n]{n}

\newvariable\nk[nom=Nonlinearity measure]{\eta_k}

% "functions": variables that depend on parameters

%% single magnets:
\newmvar\newfunc\magforce{F_m}[elem={\mdim,\ndisp},index={1,2}]{nom={Magnet force vector}}
\newmvar\newfunc\nforce{f_m}[elem={\ndisp},index=1]{nom=Normalised magnet force}
\newmvar\newfunc\magstiffness{K_m}[elem={\mdim,\ndisp},index={1,2}]{nom=Magnet stiffness}
\newmvar\newfunc\nstiffness{k_m}[elem={\ndisp},index=1]{nom=Normalised magnet stiffness}

%% QZS system:
\newmvar\newfunc\frepl{F_{\mathrm{repl}}}[elem={\mdim,\ngap,\ndispZ},index={1,2,3}]{nom=Magnet force (repulsion magnet)}
\newmvar\newfunc\fattr{F_{\mathrm{attr}}}[elem={\mdim,\ngap,\ndispZ},index={1,2,3}]{nom=Magnet force (attraction magnet)}

\newmvar\newfunc\magforceZ{F_z}[elem={\mdim,\ngap,\ndispZ},index={1,2,3}]{nom=Total vertical magnet force function}
\newmvar\newfunc\nforceZ{f_z}[elem={\ngap,\ndispZ},index={1,2}]{nom=Normalised vertical magnet force}
\newmvar\newfunc\magstiffnessZ{K_z}[elem={\mdim,\ngap,\ndispZ},index={1,2,3}]{nom=Total vertical magnet stiffness function}
\newmvar\newfunc\nstiffnessZ{k_z}[elem={\ngap,\ndispZ},index={1,2}]{nom=Normalised vertical magnet stiffness}

\newmvar\newfunc\krepl{K_{\mathrm{repl}}}[elem={\mdim,\ngap,\heq{} },index={1,2,3}]{nom=Magnet stiffness  (repulsion magnet)}
\newmvar\newfunc\kattr{K_{\mathrm{attr}}}[elem={\mdim,\ngap,\heq{} },index={1,2,3}]{nom=Magnet stiffness  (attraction magnet)}
\newmvar\newfunc\QZSkratio{\kappa}[elem={\mdim,\ngap,\heq{} },index={1,2,3}]{nom=Stiffness ratio}

\newmvar\newfunc\heq{h_q}[elem={\mdim,\ngap,\mass},index={1,2,3}]{nom=Normalised displacement at equilibrium}
\newmvar\newfunc\keq{K_q}[elem={\mdim,\ngap,\mass},index={1,2,3}]{nom=Stiffness at equilibrium}
\newmvar\newfunc\feq{f_q}[elem={\mdim,\ngap,\mass},index={1,2,3}]{nom=Normalised force at equilibrium}

\def\mathlog\left[#1\right]{\ln\fn{#1}}
\def\mathatan\left[#1\right]{\arctan\fn{#1}}
\newcommand\eqdef{\stackrel{\mathrm{\tiny def}}{=}}

%%%%%% ZKS %%%%%%%%%

\newglossaryentry{zks}{name={\QZS/ inclined springs}, description={\nopostdesc}}
\def\nomenparent{zks}

\providecommand\labelsize{\scriptsize}

\newvariable\dispvert[nom={Vertical displacement},label=dispvert]{z}
\newvariable\dispaxial[nom={Axial displacement},label=dispaxial]{z}
\newvariable\dispradial[nom=Eccentric (radial) distance between two cylindrical objects]{e_r}
\newvariable\disphoriz[nom=Horizontal displacement,label=disphoriz]{y}
%\newvariable\ZKSdisp[nom=Vertical displacement of the inclined spring]{z}
\let\ZKSdisp\dispvert
\newvariable\ZKSdispMin[nom=Maximum deflection of the vertical spring]{z_{\mathrm{min}}}
\newvariable\ZKSshift[nom=Horizontal displacement of the inclined spring,label=ZKS-x]{x}

\newvariable\ZKSwidth[nom=Inclined spring horizontal dimension,label=ZKSwidth]{w}
\newvariable\ZKSheight[nom=Inclined spring vertical dimension]{h}
\newvariable\ZKSlength[nom=Undeflected inclined spring length]{L_0}
\newmvar\newfunc\ZKSlengthcomp{L}[elem={\ZKSdisp,\ZKSshift},index={1,2}]{nom=Length of inclined spring under load}

\newvariable\ZKSvlength[nom=Undeflected vertical spring length]{H_0}

\newmvar\newfunc\ZKSvlengthcomp{H}[elem={\ZKSdisp,\ZKSshift},index={1,2}]{nom=Length of vertical spring under load,label=ZKS-H}

\newcommand\ZKSincl{i}
\newcommand\ZKSvert{v}

\newcommand\ZKScompress{C}
\newvariable\ZKScompressI[
  nom=Compression of the inclined springs at \qzs/]{\ZKScompress_\ZKSincl}
\newvariable\ZKScompressV[
  nom=Compression of the vertical spring at \qzs/]{\ZKScompress_\ZKSvert}

\newvariable\ZKSlengthratio[
   sort=zzzgreek-eta,
    nom=Ratio between inclined and vertical
        spring lengths]{\eta}
\newvariable\ZKSratio[
    label=ZKSratio,
    nom=Ratio between the inclined spring
        width and height]
  {\gamma}
\newvariable\ZKSkratio[
    label=ZKSkratio,
    nom=Ratio between the inclined and
        vertical spring stiffnesses]
  {\alpha}

\newvariable\ZKSnorm[nom=Inclined spring normalised displacement in the load bearing direction]{\xi}
\newvariable\ZKSnormMin[nom=Inclined spring maximum normalised displacement below the equilibrium before the spring reaches zero deflection]{\xi_{\mathrm{min}}}


\newvariable\ZKSoff[nom=Percentage difference between $\ZKSratio$ and $\ZKSratioQZS$]{\epsilon}

\newcommand\ZKSQZS{_{\textsc{qzs}}}

\newvariable\ZKSlengthratioQZS[
    nom=Value of $\ZKSlengthratio$ corresponding
        to \qzs/ in both directions]
  {\eta\ZKSQZS}
\newvariable\ZKSkratioQZS[
    nom=Value of $\ZKSkratio$ corresponding to
        \qzs/ in both directions]
  {\alpha\ZKSQZS}
\newvariable\ZKSratioQZS[
    nom=Value of $\ZKSratio$ for which \qzs/ in
        the vertical direction is achieved,
    sort=\gamma]
  {\ZKSratio\ZKSQZS}

\newcommand\ZKSstiff{k}
\newvariable\ZKSstiffincl[nom=Inclined spring stiffness]{\ZKSstiff_\ZKSincl}
\newvariable\ZKSstiffvert[nom=Vertical spring stiffness]{\ZKSstiff_\ZKSvert}

\newvariable\ZKSstiffnessV[nom=Stiffness characteristic in the vertical direction]{K_v}
\newvariable\ZKSstiffnessH[nom=Stiffness characteristic in the horizontal direction]{K_h}

\newcommand\ZKSforce{F}

\newmvar\newfunc\ZKSforceincl{\ZKSforce_\ZKSincl}[elem={\ZKSdisp,\ZKSshift},index={1,2}]
 {nom=Force characteristic of the inclined spring}
\newmvar\newfunc\ZKSforcevert{\ZKSforce_\ZKSvert}[elem={\ZKSdisp,\ZKSshift},index={1,2}]
 {nom=Force characteristic of the vertical spring}
\newmvar\newfunc\ZKSforcetotal{\ZKSforce_t}[elem={\ZKSdisp,\ZKSshift},index={1,2}]
 {nom=Force characteristic of the \qzs/ spring system}

\newmvar\newfunc\ZKSforceinclV{\ZKSforce_{\ZKSincl_v}}[elem=\ZKSdisp,index=1]
 {nom=Vertical component of $\ZKSforceincl$}
\newmvar\newfunc\ZKSforcevertV{\ZKSforce_{\ZKSvert_v}}[elem=\ZKSdisp,index=1]
 {nom=Vertical component of $\ZKSforcevert$}
\newmvar\newfunc\ZKSforcetotalV{\ZKSforce_{t_v}}[elem=\ZKSdisp,index=1]
 {nom=Vertical component of $\ZKSforcetotal$}

\newmvar\newfunc\ZKSforceinclH{\ZKSforce_{\ZKSincl_h}}[elem={\ZKSdisp,\ZKSshift},index={1,2}]
 {nom=Horizontal component of $\ZKSforceincl$}
\newmvar\newfunc\ZKSforcevertH{\ZKSforce_{\ZKSvert_h}}[elem={\ZKSdisp,\ZKSshift},index={1,2}]
 {nom=Horizontal component of $\ZKSforcevert$}
\newmvar\newfunc\ZKSforcetotalH{\ZKSforce_{t_h}}[elem={\ZKSdisp,\ZKSshift},index={1,2}]
 {nom=Horizontal component of $\ZKSforcetotal$}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RIG
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newglossaryentry{xpmt}{name={Experimental prototype}, description={\nopostdesc}}
\def\nomenparent{xpmt}

\newcommand\VariableBeam      [1]{#1_b}
\newcommand\VariableSensor    [1]{#1_s}
\newcommand\VariableRigMagnets[1]{#1_m}

\newvariable\InertiaMoment[label=inertiaI,nom=Moment of inertia]{I}
\newvariable\InertiaMomentBeam[nom=Beam moment of inertia]{\VariableBeam\InertiaMoment}
\newvariable\InertiaMomentMagnets[nom=Magnets moment of inertia]{\VariableRigMagnets\InertiaMoment}
\newvariable\InertiaMomentTotal[nom=Total moment of inertia]{\InertiaMoment_t}

%\newvariable\BlockInertiaLength[nom=Block length for calculating moment of inertia]{a}
%\newvariable\BlockInertiaHeight[nom=Block height for calculating moment of inertia]{b}
%\newvariable\BlockInertiaOffset[nom=Block offset for calculating moment of inertia]{d}
%\newvariable\BlockInertiaMass[label=mm,nom=Block mass for calculating moment of inertia]{m}

\newvariable\MassBeam[nom=Beam mass]{\VariableBeam m}
\newvariable\MassBeamOuter[nom=Beam `outer' mass]{m_1}
\newvariable\MassBeamInner[nom=Beam `inner' mass]{m_2}
\newvariable\LengthBeam[nom=Beam length]{\VariableBeam L}
\newvariable\HeightBeam[nom=Beam height]{\VariableBeam h}
\newvariable\WidthBeam[nom=Beam width]{\VariableBeam w}
\newvariable\ThicknessBeam[nom=Beam shell thickness]{\VariableBeam t}

\newvariable\DensityAluminium[nom=Density of aluminium]{\rho_{\mathrm{a}}}

\newvariable\OriginBeam[nom=Beam pin origin height]{\VariableBeam o}
\newvariable\OriginMagLow[nom=Low magnet height]{ o_m }
\newvariable\OriginMagHigh[nom=High magnet height]{ o_n }
\newvariable\OriginMagGap[nom=Magnet gap]{ o_g }
\newvariable\OriginQZS[nom=\QZS/ position]{o_q}

\newvariable\MassRigMagnets[nom=Mass of the floating magnets and support]{\VariableRigMagnets m}
\newvariable\LengthRigMagnets[nom=Horizontal offset of the magnets support]{\VariableRigMagnets L}
\newvariable\HeightRigMagnets[nom=Height of the magnets support]{\VariableRigMagnets h}
\newvariable\HeightBuffer[nom=Height `buffer' to account for additional thicknesses]{h_{\epsilon}}

\newvariable\LengthSensor[nom=Horizontal offset of the laser sensor]{\VariableSensor L}
\newvariable\HeightSensor[nom=Height of the laser sensor]{\VariableSensor h}

\newvariable\DisplSensor[nom=Displacement measured by the laser sensor]{\VariableSensor x}
\newvariable\DisplSensorBeam[nom=Displacement of the beam at the position of the laser sensor from `zero']{ x_b}
\newvariable\DisplSensorBeamProj[nom=Projected displacement of the beam to the magnets support]{ x_p}
\newvariable\DisplMag[nom=Displacement of the magnets support]{x_m}

%\newvariable\RadiusMag[nom=Radius of the magnets,label=magr]{r}
%\newvariable\RadiusICoil[nom=Inner radius of the coil]{r_1}
%\newvariable\RadiusOCoil[nom=Outer radius of the coil]{r_2}
\let\RadiusICoil\iradiusCoil
\let\RadiusOCoil\oradiusCoil
\let\RadiusMag\oradiusMag

\newvariable\HeightMag[label=hh,nom=Height of the magnets]{h}
\newvariable\HeightRig[nom=Height of the rig,label=HH]{H}
\newvariable\HeightCoil[nom=Height of the coil]{h_c}
\newvariable\GapCoil[nom=Axial gap between the dual coils,label=gap-coil]{G}

\newvariable\DispMag[label=xx,nom=Displacement from \qzs/]{x}
\newvariable\AngleMag[nom=Angle of the beam]{\theta}
\newvariable\MomentMag[nom=Moment produced by the magnet forces]{M_\theta}
\newvariable\ForceRigMagnets[nom=Force to the magnets]{F_x}
\newvariable\EquivMassRig[nom=Equivalent mass of the beam]{m_e}

\newvariable\rigNormGap[label=rignormgap,nom=Normalised magnet gap]{g}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%% MULTIPOLE

\newglossaryentry{mup}{name={Multipole magnet design}, description={\nopostdesc}}
\def\nomenparent{mup}

\newvariable\mupi[nom={Magnet index in the $\ax$ direction.},label=mupi]{i}
\newvariable\mupj[nom={Magnet index in the $\ay$ direction.},label=mupj]{j}

\newvariable\muplength[nom=Multipole array length,label=l-mup]{l}
\newvariable\mupheight[nom=Multipole array height,label=h-mup]{h}
%\newvariable\mupdepth[nom=Multipole array depth,label=d-mup]{d}
\newvariable\springDepth[nom=Magnetic spring depth,label=springdepth]{d}
\let\mupdepth\springDepth

\newvariable\mupwavelength[nom=Multipole array wavelength]{\lambda}
%\newvariable\mupfacegap[nom=Multipole array face gap,label=g-mup]{G}
\let\mupfacegap\magnetGap
\newvariable\mupmaglength[nom=Length of each magnet in a multipole array,label=m-mup]{m}
\newvariable\mupmagperwave[nom=Multipole array number of magnets per wavelength,label=R-mup]{R}
\newvariable\mupNmag[nom=Multipole array number of magnets,label=N-mup]{N}
\newvariable\mupNwaves[nom=Multipole array number of wavelengths]{W}
\let\mupNwave\mupNwaves % oops

\newvariable\mupqlh[label=mup-ql,nom={Length of horizontally-magnetised quasi-Halbach array magnets}]{m_1}
\newvariable\mupqlv[label=mup-qL,nom={Length of vertically-magnetised quasi-Halbach array magnets}]{m_2}
\newvariable\mupqratio[label=gamma-mup,nom={Ratio between magnet lengths in a quasi-Halbach array}]{\gamma}

\newvariable\mupmagrot[nom=Multipole array magnetisation rotation between successive magnets]{\vartheta}
\newvariable\mupmagpol[nom=Magnetisation direction of the first magnet in a multipole array]{\vartheta_0}
\newvariable\mupmagpolx[nom=Magnetisation direction in the $\ax$--$\az$ plane of the first magnet in a multipole array]{\vartheta_{xz}}
\newvariable\mupmagpoly[nom=Magnetisation direction in the $\ay$--$\az$ plane of the first magnet in a multipole array]{\vartheta_{yz}}
\newvariable\muphdgap[nom={Dual-multipole array horizontal offset}]{p}
%\newvariable\muphdispl[label=beta-mup,nom={Multipole array horizontal displacement}]{y}
%\newvariable\mupvdispl[label=delta-mup,nom={Multipole array vertical displacement}]{z}
\let\muphdispl\disphoriz
\let\mupvdispl\dispvert
%\newvariable\volume[nom=Multipole array volume,label=V-mup]{V}
\newvariable\magnamp[nom=Amplitude of magnetisation vector,label=M-mup]{M}

%%%%%%%%% OBLIQUE

\newglossaryentry{mbq}{name={Inclined magnet design}, description={\nopostdesc}}
\def\nomenparent{mbq}

\newcommand\mbqvdir{y}
\newcommand\mbqhdir{x}
\newcommand\mbqpdir{z}
\let\mbqvaxis\ay
\let\mbqhaxis\ax
\let\mbqpaxis\az

\newvariable\mbqvpert[nom={Perturbation in $\mbqvdisp$.}]{\Delta\mbqvdir}
\newvariable\mbqhpert[nom={Perturbation in $\mbqhdisp$.}]{\Delta\mbqhdir}
\newvariable\mbqrotpert[nom={Perturbation in $\mbqrotz$.}]{\Delta\varphi}

% \newvariable\mbqmass[nom=Inclined]{M}
\let\mbqmass\mass
\newvariable\mbqmomentofinertia[nom=Inclined magnet system moment of inertia]{I_m}
\newvariable\mbqrotz[label=zzzgreek-uu,nom=Inclined magnets planar rotation]{\varphi}
\newcommand\mbqvelrotz{\dot{\mbqrotz}}
\newcommand\mbqaccrotz{\ddot{\mbqrotz}}
\newvariable\mbqvdisp[nom=Inclined magnets vertical displacement]{\mbqvdir}
\newvariable\mbqhdisp[nom=Inclined magnets horizontal displacement]{\mbqhdir}
\newvariable\mbqpdisp[nom=Inclined magnets out-of-plane displacement]{\mbqpdir}
\newcommand\mbqvvel{\dot{\mbqvdisp}}
\newcommand\mbqhvel{\dot{\mbqhdisp}}
\newcommand\mbqpvel{\dot{\mbqpdisp}}
\newcommand\mbqvacc{\ddot{\mbqvdisp}}
\newcommand\mbqhacc{\ddot{\mbqhdisp}}
\newcommand\mbqpacc{\ddot{\mbqpdisp}}
%\newvariable\mbqmagh[label=a-mbq,nom=Cuboid magnet depth]{a}
%\newvariable\mbqmagw[label=b-mbq,nom=Cuboid magnet face size]{b}
\let\mbqmagh\lengthCub
\let\mbqmagw\faceCub

\newvariable\mbqforce[label=Fxyz-mbq,nom=Force vector between inclined magnets in the global coordinate system]{\vect F}
\newvariable\mbqptorque[nom=Inclined magnets torque]{T_\mbqpdir}

\newcommand\mbqvforce{\forceMag_\mbqvdir}
\newcommand\mbqhforce{\forceMag_\mbqhdir}
\newcommand\mbqpforce{\forceMag_\mbqpdir}
\newcommand\mbqvstiff{\stiffness_\mbqvdir}
\newcommand\mbqhstiff{\stiffness_\mbqhdir}
\newcommand\mbqpstiff{\stiffness_\mbqpdir}
\newcommand\mbqzrotstiff{\stiffness_\varphi}
\newcommand\mbqvdamp{\dampingRel_\mbqvdir}
\newcommand\mbqhdamp{\dampingRel_\mbqhdir}
\newcommand\mbqzrotdamp{\dampingRel_\varphi}

\newvariable\mbqmforce[nom=Force vector between inclined magnets in the local coordinate systems of the fixed magnet]{\vect G}
\newvariable\mbqmagangle[label=theta-mbq,nom=Inlined magnets inclination]{\theta}
\newvariable\mbqcompmagangle[label=phi-mbq,nom=Inlined magnets inclination (complementary)]{\phi}
\newvariable\mbqoffset[label=d-mbq,nom=Inclined magnets centres horizontal offset at the nominal position]{d}

\newvariable\mbqunit[nom={Cuboid magnet unit length, cube root of volume},label=mbqunit]{u}
\let\msize\mbqunit
\newvariable\mbqlever[label=l-mbq,nom={Lever arm}]{l}
\let\leverArm\mbqlever
\newvariable\mbqCoMvec[label=lvec-mbq,nom={Displacement vector between magnet centre and centre of mass}]{\vect l}
\newvariable\mbqCoMvec[label=tvec-mbq,nom={Lever arm vector }]{\vect t}
\newvariable\mbqleverdispl[label=pvec-mbq,nom={Displacement vector due to rotation around centre of mass}]{\vect p}
%\newvariable\mbqmagratio[label=gamma-mbq]{\gamma}
%\newvariable\mbqvolume[label=V-mbq]{V}
\let\mbqmagratio\ratioCub
\let\mbqvolume\volume
\newvariable\mbqmasseq[nom=Equivalent mass]{m_{\mathrm{eq}}}

\newvariable\mbqdispl[nom=Position vector,label=mbqdispl]{\vect r}
\newvariable\mbqmdispl[nom=Position vector,label=mbqmdispl]{\vect s}
\newvariable\mbqlocl[nom=Displacement vectors from the spring magnet centres to the centre of rotation in the coordinate system of the magnets,label=mbqlocl]{\vect t}

%\newcommand\mbqrot[1]{\mathbf R(#1)}
\let\mbqrot\rotZ

%%%%%


